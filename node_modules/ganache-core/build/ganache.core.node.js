!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Ganache",[],t):"object"==typeof exports?exports.Ganache=t():e.Ganache=t()}(global,function(){return function(e){var t={};function __webpack_require__(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,__webpack_require__),r.l=!0,r.exports}return __webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.d=function(e,t,n){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.t=function(e,t){if(1&t&&(e=__webpack_require__(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(__webpack_require__.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)__webpack_require__.d(n,r,function(t){return e[t]}.bind(null,r));return n},__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=33)}([function(e,t,n){let r=n(3);e.exports={buffer:function(e){let t;return"string"==typeof e?(t=(t=0===e.indexOf("0x")?e.slice(2):e).length%2==1?`0${t}`:t,t=Buffer.from(t,"hex")):t=Buffer.isBuffer(e)?e:Buffer.from(e),t},hex:function(e){if("string"==typeof e){if(0===e.indexOf("0x"))return e.trim();e=new r.BN(e)}if("boolean"==typeof e&&(e=e?1:0),"number"==typeof e)e=r.intToHex(e);else{if(null==e)return"0x";"object"==typeof e&&(e=e.toString("hex"))}return r.addHexPrefix(e)},_rpcQuantityHexString:function(e){return e=(e=this.hex(e)).replace(/^(?:0x)(?:0+(.+?))?$/,"0x$1")},rpcQuantityHexString:function(e){return"0x"===(e=this._rpcQuantityHexString(e))&&(e="0x0"),e},rpcDataHexString:function(e,t){if("number"==typeof t)e=this.hex(e).replace("0x",""),e=new Array(t-e.length).fill("0").join("")+e;else{if(0===e.length)return"0x";(e=this.hex(e).replace("0x","")).length%2!=0&&(e="0"+e)}return"0x"+e},nullableRpcDataHexString:function(e,t){if(null===e)return null;{const n=this.rpcDataHexString(e,t);return"0x"===n?null:n}},nullableRpcQuantityHexString:function(e,t){if(null===e)return null;{const n=this._rpcQuantityHexString(e,t);return"0x"===n?null:n}},hexWithZeroPadding:function(e){const t=(e=this.hex(e)).replace("0x","");return 1&t.length?"0x0"+t:e},number:function(e){if("number"==typeof e)return e;if("string"==typeof e&&0!==e.indexOf("0x"))return parseInt(e,10);var t=r.toBuffer(e);return r.bufferToInt(t)},rpcError:function(e,t,n){return JSON.stringify({jsonrpc:"2.0",id:e,error:{code:t,message:n}})}}},function(e,t){e.exports=require("util")},function(e,t){e.exports=require("async")},function(e,t){e.exports=require("ethereumjs-util")},function(e,t){e.exports=require("web3-provider-engine/subproviders/subprovider.js")},function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("source-map-support/register")},function(e,t){e.exports=require("ethereumjs-account")},function(e,t,n){var r=n(1).inherits,o=n(0),i=n(41);function RuntimeError(e,t){Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.results={},this.hashes=[],this.combine(e,t)}r(RuntimeError,Error),RuntimeError.prototype.combine=function(e,t){if(e instanceof RuntimeError)for(var n=e,r=Object.keys(n.results),a=0;a<r.length;a++){var s=r[a];this.results[s]=n.results[s],Array.prototype.push.apply(this.hashes,n.hashes)}else{var c=t.results;for(a=0;a<e.length;a++){var u=e[a],l=c[a];if(1!==l.vm.exception){var h,p=o.hex(u.hash());this.hashes.push(p);var f=l.vm.return;f&&"08c379a0"===f.slice(0,4).toString("hex")&&(h=i.rawDecode(["string"],f.slice(4))[0]),this.results[p]={error:l.vm.exceptionError.error||l.vm.exceptionError,program_counter:l.vm.runState.programCounter,return:o.hex(l.vm.return),reason:h}}}}if(1===this.hashes.length){var d=this.results[this.hashes[0]],g="VM Exception while processing transaction: "+d.error;d.reason&&(g+=" "+d.reason),this.message=g}else{for(g="Multiple VM Exceptions while processing transactions: \n\n",a=0;a<this.hashes.length;a++)g+=(p=this.hashes[a])+": "+(d=this.results[p]).error,d.reason&&(g+=" "+d.reason),g+="\n";this.message=g}},RuntimeError.prototype.count=function(){return Object.keys(this.results).length},RuntimeError.fromResults=function(e,t){var n=new RuntimeError(e,t);return 0===n.count()?null:n},e.exports=RuntimeError},function(e,t,n){const r=n(42),o=n(43),i=n(3),a=n(44),s=i.rlp,c=n(0),u=r.prototype.sign,l=function(){return null!=this._hash?this._hash:o.prototype.hash.apply(this,arguments)},h=Buffer.from([0]);function fixProps(e,t){e._originals=[];["nonce","gasPrice","gasLimit","value"].forEach(t=>(function(e,t,n=32){const r=e._fields.indexOf(t),o=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(e,t,{set:s=>{o.set.call(e,s),s=i.toBuffer(s),a(n>=s.length,`The field ${t} must not have more ${n} bytes`),e._originals[r]=s},get:()=>e._originals[r]})})(e,t,32));const n=Object.getOwnPropertyDescriptor(e,"v");Object.defineProperty(e,"v",{set:t=>{n.set.call(e,t);const r=i.bufferToInt(e.v);let o=Math.floor((r-35)/2);o<0&&(o=0),e._chainId=o||0}}),e.isFake()&&(Object.defineProperty(e,"from",{enumerable:!0,configurable:!0,get:e.getSenderAddress.bind(e),set:t=>{e._from=t?i.toBuffer(t):null}}),t&&t.from&&(e.from=t.from),e.hash=l)}e.exports=class e extends r{constructor(t,n=e.types.none){super(),this.type=n,fixProps(this,t),function(e,t){if(t){"string"==typeof t&&(t=c.buffer(t)),Buffer.isBuffer(t)&&(t=s.decode(t));const n=e;if(Array.isArray(t)){if(t.length>e._fields.length)throw new Error("wrong number of fields in data");t.forEach((e,t)=>{n[n._fields[t]]=i.toBuffer(e)})}else{if("object"!=(void 0===t?"undefined":typeof t))throw new Error("invalid data");{const r=Object.keys(t);e._fields.forEach(function(e){-1!==r.indexOf(e)&&(n[e]=t[e]),"gasLimit"===e?-1!==r.indexOf("gas")&&(n.gas=t.gas):"data"===e&&-1!==r.indexOf("input")&&(n.input=t.input)}),!e._chainId&&t&&null!=t.chainId&&(e.raw[n._fields.indexOf("v")]=e._chainId=t.chainId||0)}}}}(this,t)}static get types(){return{none:0,signed:1,fake:2}}static fromJSON(t,n){let r;if(t.to){const e=c.buffer(t.to);r=e.equals(Buffer.from([0]))?i.setLengthLeft(e,20):e}const o=t.data||t.input,a={nonce:i.toBuffer(c.hex(t.nonce)),from:i.toBuffer(c.hex(t.from)),value:i.toBuffer(c.hex(t.value)),gasLimit:i.toBuffer(c.hex(t.gas||t.gasLimit)),gasPrice:i.toBuffer(c.hex(t.gasPrice)),data:o?c.buffer(o):null,to:r,v:i.toBuffer(t.v),r:i.toBuffer(t.r),s:i.toBuffer(t.s)},s=new e(a,n);return s._hash=t.hash?c.buffer(t.hash):null,s}encode(){return{hash:c.nullableRpcDataHexString(this.hash()),nonce:c.nullableRpcQuantityHexString(this.nonce)||"0x",from:c.rpcDataHexString(this.from),to:c.nullableRpcDataHexString(this.to),value:c.nullableRpcQuantityHexString(this.value),gas:c.nullableRpcQuantityHexString(this.gasLimit),gasPrice:c.nullableRpcQuantityHexString(this.gasPrice),data:this.data?this.data.toString("hex"):null,v:c.nullableRpcQuantityHexString(this.v),r:c.nullableRpcQuantityHexString(this.r),s:c.nullableRpcQuantityHexString(this.s),_type:this.type}}isFake(){return(this.type&e.types.fake)===e.types.fake}isSigned(){return(this.type&e.types.signed)===e.types.signed}validateNonce(e){let t;return(t=this.isSigned()&&0===this.nonce.length?h:this.nonce).equals(e)}sign(){u.apply(this,arguments),this.type|=e.types.signed}toJsonRpc(e){const t=this.hash();let n=null;for(let r=0,o=e.transactions,i=o.length;r<i;r++)if(o[r].hash().equals(t)){n=r;break}return{hash:c.nullableRpcDataHexString(t),nonce:c.rpcQuantityHexString(this.nonce),blockHash:c.nullableRpcDataHexString(e.hash()),blockNumber:c.nullableRpcQuantityHexString(e.header.number),transactionIndex:c.nullableRpcQuantityHexString(n),from:c.rpcDataHexString(this.from),to:c.nullableRpcDataHexString(this.to),value:c.rpcQuantityHexString(this.value),gas:c.rpcQuantityHexString(this.gasLimit),gasPrice:c.rpcQuantityHexString(this.gasPrice),input:c.rpcDataHexString(this.data),v:c.nullableRpcQuantityHexString(this.v),r:c.nullableRpcQuantityHexString(this.r),s:c.nullableRpcQuantityHexString(this.s)}}hash(e=!0){let t;if(e)t=this.raw;else{const e=this._chainId;if(e>0){const n=this.raw.slice();this.v=e,this.r=0,this.s=0,t=this.raw,this.raw=n,this._chainId=e}else t=this.raw.slice(0,6)}return i.rlphash(t)}}},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("ethereumjs-block")},function(e,t,n){var r=n(0);function Log(e){var t=this;Object.keys(e).forEach(function(n){t[n]=e[n]})}Log.prototype.toJSON=function(){return{logIndex:r.rpcQuantityHexString(this.logIndex),transactionIndex:r.rpcQuantityHexString(this.transactionIndex),transactionHash:r.rpcDataHexString(this.transactionHash),blockHash:r.rpcDataHexString(this.block.hash()),blockNumber:r.rpcQuantityHexString(this.block.header.number),address:r.rpcDataHexString(this.address),data:r.rpcDataHexString(this.data),topics:this.topics,type:"mined"}},e.exports=Log},function(e,t,n){var r=n(0);function Receipt(e,t,n,r,o,i,a,s){this.tx=e,this.block=t,this.logs=n,this.gasUsed=r,this.cumulativeGasUsed=o,this.contractAddress=i,this.status=a,this.logsBloom=s,this.transactionIndex=0,this.txHash=e.hash();for(var c=0;c<t.transactions.length;c++){if(t.transactions[c].hash().equals(this.txHash)){this.transactionIndex=c;break}}}Receipt.prototype.toJSON=function(){return{transactionHash:r.rpcDataHexString(this.txHash),transactionIndex:r.rpcQuantityHexString(this.transactionIndex),blockHash:r.rpcDataHexString(this.block.hash()),blockNumber:r.rpcQuantityHexString(this.block.header.number),from:r.rpcDataHexString(this.tx.from),to:r.nullableRpcDataHexString(this.tx.to),gasUsed:r.rpcQuantityHexString(this.gasUsed),cumulativeGasUsed:r.rpcQuantityHexString(this.cumulativeGasUsed),contractAddress:null!=this.contractAddress?r.rpcDataHexString(this.contractAddress):null,logs:this.logs.map(function(e){return e.toJSON()}),status:r.rpcQuantityHexString(this.status),logsBloom:r.rpcDataHexString(this.logsBloom),v:r.rpcQuantityHexString(this.tx.v),r:r.rpcQuantityHexString(this.tx.r),s:r.rpcQuantityHexString(this.tx.s)}},e.exports=Receipt},function(e,t){class n extends Error{constructor(e,t,n){super("LevelUpArrayAdapter named '"+e+"' index out of range: index "+t+"; length: "+n),this.name=`${this.constructor.name}:${e}`,this.type=e}}e.exports={LevelUpOutOfRangeError:n,BlockOutOfRangeError:class extends n{constructor(e,t){super("blocks",e,t)}}}},function(e,t){e.exports=require("events")},function(e,t,n){"use strict";var r=n(75).version,o=n(17),i=n(76),a=n(29),s=n(30),c=n(96),u=n(97),l=n(19),h=function(){var e=this;o.packageInit(this,arguments),this.version=r,this.utils=l,this.eth=new i(this),this.shh=new c(this),this.bzz=new u(this);var t=this.setProvider;this.setProvider=function(n,r){return t.apply(e,arguments),this.eth.setProvider(n,r),this.shh.setProvider(n,r),this.bzz.setProvider(n),!0}};h.version=r,h.utils=l,h.modules={Eth:i,Net:a,Personal:s,Shh:c,Bzz:u},o.addProviders(h),e.exports=h},function(e,t){e.exports=require("web3-core")},function(e,t){e.exports=require("underscore")},function(e,t){e.exports=require("web3-utils")},function(e,t,n){n(6);let r=n(34),o=n(35),i=n(36),a=n(37),s=n(38),c=n(39),u=n(101),l=n(8),h=n(15),p=n(5);function Provider(e){const t=this;h.call(this),this.options=e=t._applyDefaultOptions(e||{});let n=new c(e,this);this.engine=new r({blockTracker:new u({blockchain:n.state.blockchain})});let l=new o;this.engine.manager=n,this.engine.addProvider(new i),this.engine.addProvider(new a),this.engine.addProvider(l),this.engine.addProvider(new s),this.engine.addProvider(n),this.engine.setMaxListeners(100),this.engine.start(),this.manager=n,this.sendAsync=this.send.bind(this),this.send=this.send.bind(this),this.close=this.close.bind(this),this._queueRequest=this._queueRequest.bind(this),this._processRequestQueue=this._processRequestQueue.bind(this),l.on("data",function(e,n){t.emit("data",e,n)})}const f={vmErrorsOnRPCResponse:!0,verbose:!1,asyncRequestProcessing:!1,logger:{log:function(){}}};Provider.prototype=Object.create(h.prototype),Provider.prototype.constructor=Provider,Provider.prototype._applyDefaultOptions=function(e){return p.merge({},f,e)},Provider.prototype.send=function(e,t){if("function"!=typeof t)throw new Error("No callback provided to provider's send function. As of web3 1.0, provider.send is no longer synchronous and must be passed a callback as its final argument.");let n=this,r=function(e){return p.cloneDeep(e)};e=Array.isArray(e)?e.map(r):r(e);let o=function(r,o){let i;if(o=p.cloneDeep(o),Array.isArray(o)){i=[];for(let t=0;t<o.length;t++)i.push(n.reportErrorInResponse(e[t],r,o[t]))}else i=n.reportErrorInResponse(e,r,o);n.options.verbose&&n.options.logger.log(" <   "+JSON.stringify(i,null,2).split("\n").join("\n <   ")),process.nextTick(()=>t(i.error?r:null,i))};n.options.verbose&&n.options.logger.log("   > "+JSON.stringify(e,null,2).split("\n").join("\n   > ")),n.options.asyncRequestProcessing?n.engine.sendAsync(e,o):n._queueRequest(e,o)},Provider.prototype.close=function(e){this.manager.state.stopMining(),this.manager.state.blockchain.close(e),this.engine.stop()},Provider.prototype._queueRequest=function(e,t){this._requestQueue||(this._requestQueue=[]),this._requestQueue.push({payload:e,callback:t}),setImmediate(this._processRequestQueue)},Provider.prototype._processRequestQueue=function(){const e=this;if(e._requestInProgress)return;e._requestInProgress=!0;let t=e._requestQueue.shift();t?e.engine.sendAsync(t.payload,(n,r)=>{e._requestQueue.length>0&&setImmediate(e._processRequestQueue),t.callback(n,r),e._requestInProgress=!1}):(e._requestInProgress=!1,e._requestQueue.length>0&&setImmediate(e._processRequestQueue))},Provider.prototype.cleanUpErrorObject=function(e,t){if(!e||!t.error)return t;let n={error:{data:{}}};return e.message?(n.error.message=e.message,n.error.data.stack=e.stack,n.error.data.name=e.name,"code"in e&&(n.error.code=e.code)):t.error||(n.error={message:e.toString()}),p.merge(t,n)};let d=["eth_sendTransaction","eth_sendRawTransaction","personal_sendTransaction"];Provider.prototype._isTransactionRequest=function(e){return-1!==d.indexOf(e.method)},Provider.prototype.reportErrorInResponse=function(e,t,n){const r=this;return t?(r._isTransactionRequest(e)&&t instanceof l&&(n.result=t.hashes[0],r.options.vmErrorsOnRPCResponse?(n.error.data||(n.error.data={}),n.error.data[t.hashes[0]]=t.results[t.hashes[0]]):delete n.error),"eth_call"!==e.method&&"eth_estimateGas"!==e.method||t instanceof l&&(r.options.vmErrorsOnRPCResponse?(n.error.data||(n.error.data={}),n.error.data[t.hashes[0]]=t.results[t.hashes[0]]):(n.result=t.results[t.hashes[0]].return||"0x",delete n.error)),r.cleanUpErrorObject(t,n)):n},e.exports=Provider},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(47).Buffer,i=n(3),a=n(10),s=n(48),c=n(49),u=n(50),l=n(51);function assert(e,t){if(!e)throw new Error(t||"Assertion failed")}function decipherBuffer(e,t){return o.concat([e.update(t),e.final()])}var h=function(e,t){if(e&&t)throw new Error("Cannot supply both a private and a public key to the constructor");if(e&&!i.isValidPrivate(e))throw new Error("Private key does not satisfy the curve requirements (ie. it is invalid)");if(t&&!i.isValidPublic(t))throw new Error("Invalid public key");this._privKey=e,this._pubKey=t};Object.defineProperty(h.prototype,"privKey",{get:function(){return assert(this._privKey,"This is a public key only wallet"),this._privKey}}),Object.defineProperty(h.prototype,"pubKey",{get:function(){return this._pubKey||(this._pubKey=i.privateToPublic(this.privKey)),this._pubKey}}),h.generate=function(e){if(!e)return new h(s(32));for(var t=new i.BN("088f924eeceeda7fe92e1f5b0fffffffffffffff",16);;){var n=s(32);if(new i.BN(i.privateToAddress(n)).lte(t))return new h(n)}},h.generateVanityAddress=function(e){for("object"!==(void 0===e?"undefined":r(e))&&(e=new RegExp(e));;){var t=s(32),n=i.privateToAddress(t);if(e.test(n.toString("hex")))return new h(t)}},h.prototype.getPrivateKey=function(){return this.privKey},h.prototype.getPrivateKeyString=function(){return i.bufferToHex(this.getPrivateKey())},h.prototype.getPublicKey=function(){return this.pubKey},h.prototype.getPublicKeyString=function(){return i.bufferToHex(this.getPublicKey())},h.prototype.getAddress=function(){return i.publicToAddress(this.pubKey)},h.prototype.getAddressString=function(){return i.bufferToHex(this.getAddress())},h.prototype.getChecksumAddressString=function(){return i.toChecksumAddress(this.getAddressString())},h.prototype.toV3=function(e,t){assert(this._privKey,"This is a public key only wallet");var n,r=(t=t||{}).salt||s(32),l=t.iv||s(16),h=t.kdf||"scrypt",p={dklen:t.dklen||32,salt:r.toString("hex")};if("pbkdf2"===h)p.c=t.c||262144,p.prf="hmac-sha256",n=a.pbkdf2Sync(o.from(e),r,p.c,p.dklen,"sha256");else{if("scrypt"!==h)throw new Error("Unsupported kdf");p.n=t.n||262144,p.r=t.r||8,p.p=t.p||1,n=c(o.from(e),r,p.n,p.r,p.p,p.dklen)}var f=a.createCipheriv(t.cipher||"aes-128-ctr",n.slice(0,16),l);if(!f)throw new Error("Unsupported cipher");var d=o.concat([f.update(this.privKey),f.final()]),g=i.keccak256(o.concat([n.slice(16,32),o.from(d,"hex")]));return{version:3,id:u({random:t.uuid||s(16)}),address:this.getAddress().toString("hex"),crypto:{ciphertext:d.toString("hex"),cipherparams:{iv:l.toString("hex")},cipher:t.cipher||"aes-128-ctr",kdf:h,kdfparams:p,mac:g.toString("hex")}}},h.prototype.getV3Filename=function(e){return["UTC--",(e?new Date(e):new Date).toJSON().replace(/:/g,"-"),"--",this.getAddress().toString("hex")].join("")},h.prototype.toV3String=function(e,t){return JSON.stringify(this.toV3(e,t))},h.fromPublicKey=function(e,t){return t&&(e=i.importPublic(e)),new h(null,e)},h.fromExtendedPublicKey=function(e){return assert("xpub"===e.slice(0,4),"Not an extended public key"),e=l.decode(e).slice(45),h.fromPublicKey(e,!0)},h.fromPrivateKey=function(e){return new h(e)},h.fromExtendedPrivateKey=function(e){assert("xprv"===e.slice(0,4),"Not an extended private key");var t=l.decode(e);return assert(0===t[45],"Invalid extended private key"),h.fromPrivateKey(t.slice(46))},h.fromV1=function(e,t){assert("string"==typeof t);var n="object"===(void 0===e?"undefined":r(e))?e:JSON.parse(e);if("1"!==n.Version)throw new Error("Not a V1 wallet");if("scrypt"!==n.Crypto.KeyHeader.Kdf)throw new Error("Unsupported key derivation scheme");var s=n.Crypto.KeyHeader.KdfParams,u=c(o.from(t),o.from(n.Crypto.Salt,"hex"),s.N,s.R,s.P,s.DkLen),l=o.from(n.Crypto.CipherText,"hex");if(i.keccak256(o.concat([u.slice(16,32),l])).toString("hex")!==n.Crypto.MAC)throw new Error("Key derivation failed - possibly wrong passphrase");var p=decipherBuffer(a.createDecipheriv("aes-128-cbc",i.keccak256(u.slice(0,16)).slice(0,16),o.from(n.Crypto.IV,"hex")),l);return new h(p)},h.fromV3=function(e,t,n){assert("string"==typeof t);var s,u,l="object"===(void 0===e?"undefined":r(e))?e:JSON.parse(n?e.toLowerCase():e);if(3!==l.version)throw new Error("Not a V3 wallet");if("scrypt"===l.crypto.kdf)u=l.crypto.kdfparams,s=c(o.from(t),o.from(u.salt,"hex"),u.n,u.r,u.p,u.dklen);else{if("pbkdf2"!==l.crypto.kdf)throw new Error("Unsupported key derivation scheme");if("hmac-sha256"!==(u=l.crypto.kdfparams).prf)throw new Error("Unsupported parameters to PBKDF2");s=a.pbkdf2Sync(o.from(t),o.from(u.salt,"hex"),u.c,u.dklen,"sha256")}var p=o.from(l.crypto.ciphertext,"hex");if(i.keccak256(o.concat([s.slice(16,32),p])).toString("hex")!==l.crypto.mac)throw new Error("Key derivation failed - possibly wrong passphrase");var f=decipherBuffer(a.createDecipheriv(l.crypto.cipher,s.slice(0,16),o.from(l.crypto.cipherparams.iv,"hex")),p);return new h(f)},h.fromEthSale=function(e,t){assert("string"==typeof t);var n="object"===(void 0===e?"undefined":r(e))?e:JSON.parse(e),s=o.from(n.encseed,"hex"),c=a.pbkdf2Sync(t,t,2e3,32,"sha256").slice(0,16),u=decipherBuffer(a.createDecipheriv("aes-128-cbc",c,s.slice(0,16)),s.slice(16)),l=new h(i.keccak256(u));if(l.getAddress().toString("hex")!==n.ethaddr)throw new Error("Decoded key mismatch - possibly wrong passphrase");return l},e.exports=h},function(e,t,n){var r=n(0),o=n(7).default,i=n(11),a=n(12),s=n(13),c=n(54),u=n(8),l=n(23),h=n(3),p=n(2),f=n(55),d=n(56),g=n(15),m=n(70),b=n(5),y=n(1).promisify;const k=h.BN;function BlockchainDouble(e){if(g.apply(this),this.options=e=this._applyDefaultOptions(e||{}),this.logger=e.logger||console,this.data=new d(e),null!=e.trie&&null!=e.db_path)throw new Error("Can't initialize a TestRPC with a db and a custom trie.");this.pending_transactions=[],this.blockGasLimit=e.gasLimit,this.defaultTransactionGasLimit=e.defaultTransactionGasLimit,this.timeAdjustment=0}const v={gasLimit:"0x6691b7",defaultTransactionGasLimit:"0x15f90",time:null,debug:!1,hardfork:"petersburg",allowUnlimitedContractSize:!1};BlockchainDouble.prototype=Object.create(g.prototype),BlockchainDouble.prototype.constructor=BlockchainDouble,BlockchainDouble.prototype._applyDefaultOptions=function(e){return b.merge(e,v,Object.assign({},e))},BlockchainDouble.prototype.initialize=function(e,t){var n=this;this.data.initialize(function(r){if(r)return t(r);n.latestBlock(function(r,o){if(r)return t(r);var i=n.options,a=null;if(o&&(a=o.header.stateRoot),n.stateTrie=n.createStateTrie(n.data.trie_db,a),n.vm=i.vm||n.createVMFromStateTrie(n.stateTrie,!0),i.time&&n.setTime(i.time),o)return n.emit("block",o),t();n.createGenesisBlock(function(r,o){if(r)return t(r);e=e||[],n.vm.stateManager.checkpoint(()=>{p.eachSeries(e,function(e,t){n.vm.stateManager.putAccount(h.toBuffer(e.address),e.account,t)},function(e){if(e)return t(e);n.vm.stateManager.commit(()=>{n.putBlock(o,[],[],t)})})})})})})},BlockchainDouble.prototype.createVMFromStateTrie=function(e,t){const n=this,o=new c({state:e,blockchain:{getBlock:function(e,t){try{e=r.number(e)}catch(e){}n.getBlock(e,t)}},activatePrecompiles:t||!1,hardfork:n.options.hardfork,allowUnlimitedContractSize:n.options.allowUnlimitedContractSize});return!0===n.options.debug&&o.on("step",function(e){var t=e.opcode.name,o=e.opcode.in;if(o){var i=e.stack.slice(-o).map(e=>r.hex(e)).join(" ");n.logger.log(`${t} ${i}`)}else n.logger.log(t)}),o},BlockchainDouble.prototype.createStateTrie=function(e,t){return new l(e,t)},BlockchainDouble.prototype.createGenesisBlock=function(e){this.createBlock(e)},BlockchainDouble.prototype.latestBlock=function(e){this.data.blocks.last(function(t,n){if(t)return e(t);e(null,n)})},BlockchainDouble.prototype.getEffectiveBlockNumber=function(e,t){return"string"!=typeof e&&(e=r.hex(e)),e.indexOf("0x")>=0?t(null,r.number(e)):"latest"===e||"pending"===e?this.getHeight(t):"earliest"===e?t(null,0):void 0},BlockchainDouble.prototype.getBlock=function(e,t){var n=this;if("string"!=typeof e&&(e=r.hex(e)),e.indexOf("0x")>=0){var o=e;if(!(o.length>40))return this.data.blocks.get(r.number(o),t);this.data.blockHashes.get(r.hex(o),function(e,r){return e?t(e):n.data.blocks.get(r,t)})}else{if("latest"===e||"pending"===e)return this.latestBlock(t);if("earliest"===e)return this.data.blocks.first(t);process.nextTick(t,new Error('Invalid `blockNumber`: "'+e+'"'))}},BlockchainDouble.prototype.putBlock=function(e,t,n,o){var i=this;e.header.stateRoot=this.stateTrie.root,this.data.blocks.length(function(a,s){if(a)return o(a);var c=[i.data.blocks.push.bind(i.data.blocks,e),i.data.blockLogs.push.bind(i.data.blockLogs,t),i.data.blockHashes.set.bind(i.data.blockHashes,r.hex(e.hash()),s)];e.transactions.forEach(function(e,t){var o=r.hex(e.hash());c.push(i.data.transactions.set.bind(i.data.transactions,o,e),i.data.transactionReceipts.set.bind(i.data.transactionReceipts,o,n[t]))}),p.parallel(c,(t,n)=>{t||i.emit("block",e),o(t,n)})})},BlockchainDouble.prototype.popBlock=function(e){var t=this;this.data.blocks.last(function(n,o){if(n)return e(n);if(null==o)return e(null,null);var i=[],a=r.hex(o.hash());o.transactions.forEach(function(e){var n=r.hex(e.hash());i.push(t.data.transactions.del.bind(t.data.transactions,n),t.data.transactionReceipts.del.bind(t.data.transactionReceipts,n))}),i.push(t.data.blockLogs.pop.bind(t.data.blockLogs),t.data.blockHashes.del.bind(t.data.blockHashes,a),t.data.blocks.pop.bind(t.data.blocks)),p.series(i,function(n){if(n)return e(n);t.data.blocks.last(function(n,r){if(n)return e(n);t.vm.stateManager.setStateRoot(r.header.stateRoot,function(n){n||(t.vm.stateManager._storageTries={}),e(n,o)})})})})},BlockchainDouble.prototype.clearPendingTransactions=function(){this.pending_transactions=[]},BlockchainDouble.prototype.createBlock=function(e,t,n){var o=this;"function"==typeof e?(n=e,e=null,t=!1):"function"==typeof t&&(n=t,t=!1);var a=new i;!function(t){if(e)return t(null,e);o.latestBlock(t)}(function(e,i){if(e)return n(e);if(a.header.gasLimit=o.blockGasLimit,null!=i&&t)a.header.number=i.header.number,a.header.timestamp=i.header.timestamp,a.header.parentHash=i.header.parentHash;else{var s=null!=i?r.number(i.header.number):-1;a.header.number=r.hex(s+1),a.header.timestamp=r.hex(o.currentTime()),null!=i&&(a.header.parentHash=r.hex(i.hash()))}n(null,a)})},BlockchainDouble.prototype.getQueuedNonce=function(e,t){var n=null,i=r.buffer(e);if(this.pending_transactions.forEach(function(e){if(e.from.equals(i)){var t=new k(e.nonce);(null===n||t.gt(n))&&(n=t)}}),null!=n)return t(null,n.iaddn(1).toArrayLike(Buffer));this.stateTrie.get(i,function(e,n){if(e)return t(e);var r=new o(n);t(null,0===r.nonce.length?Buffer.from([0]):r.nonce)})},BlockchainDouble.prototype.queueTransaction=function(e){this.pending_transactions.push(e)},BlockchainDouble.prototype.sortByPriceAndNonce=function(){var e={};this.pending_transactions.forEach(t=>{const n=t.from.toString("hex"),r=e[n];r?r.push(t):e[n]=[t]});var t=function(e,t){return parseInt(r.hex(e.nonce),16)-parseInt(r.hex(t.nonce),16)};Object.keys(e).forEach(n=>{e[n].sort(t)});var n=new f(function(e,t){return parseInt(r.hex(t.gasPrice),16)-parseInt(r.hex(e.gasPrice),16)});Object.keys(e).forEach(t=>{n.push(e[t].shift())});const o=[];for(;n.size()>0;){const t=n.pop();let r=t.from.toString("hex");e[r].length>0&&n.push(e[r].shift()),o.push(t)}this.pending_transactions=o},BlockchainDouble.prototype.readyCall=function(e,t,n,r){const o=(e,n,o)=>{if(n)return r(n);this.createBlock(o,t,(t,n)=>{if(t)return r(t);n.transactions.push(e),n.header.gasLimit=e.gasLimit;const i={tx:e,block:n,skipBalance:!0,skipNonce:!0},a=this.createStateTrie(this.data.trie_db,o.header.stateRoot),s=this.createVMFromStateTrie(a);r(null,s,i)})};"latest"===n?this.latestBlock(o.bind(null,e)):this.getBlock(n,o.bind(null,e))},BlockchainDouble.prototype.processCall=function(e,t,n){this.readyCall(e,!0,t,(t,r,o)=>{t?n(t):r.runTx(o,function(r,o){if(r&&r instanceof Error==!1&&(r=new Error("VM error: "+r)),r)return n(r,t);r=u.fromResults([e],{results:[o]}),n(r,o)})})},BlockchainDouble.prototype.estimateGas=function(e,t,n){this.readyCall(e,!1,t,(e,t,r)=>{e?n(e):m(t,r,n)})},BlockchainDouble.prototype.processBlock=function(e,t,n,o){var i=this;"function"==typeof n&&(o=n,n=!0),e.runBlock({block:t,generate:!0,skipBlockValidation:!0},async function(e,c){if(e&&e instanceof Error==!1&&(e=new Error("VM error: "+e)),e)return void o(e);e=u.fromResults(t.transactions,c);var p=[],f=[],d=0;c.results.forEach(function(e){d+=r.number(e.gasUsed)}),t.header.gasUsed=h.toBuffer(r.hex(d));const g=new l,m=new l,b=[],k=(e,t,n)=>y(e.put.bind(e))(t,n);for(var v=0;v<c.receipts.length;v++){var x=c.results[v],_=c.receipts[v],w=t.transactions[v],B=w.hash(),S=[];if(1===x.vm.exception)for(var T=0;T<_.logs.length;T++){for(var A=_.logs[T],D=r.hex(A[0]),F=[],N=0;N<A[1].length;N++)F.push(r.hex(A[1][N]));var C=r.hex(A[2]),E=new a({logIndex:r.hex(T),transactionIndex:r.hex(v),transactionHash:B,block:t,address:D,data:C,topics:F,type:"mined"});p.push(E),S.push(E)}let e=new s(w,t,S,x.gasUsed.toArrayLike(Buffer),_.gasUsed,x.createdAddress,_.status,r.hex(_.bitvector));f.push(e);const n=[_.status,_.gasUsed,_.bitvector,_.logs],o=h.rlp.encode(n),i=h.rlp.encode(v);b.push(k(g,i,w.serialize())),b.push(k(m,i,o))}function done(n){if(n)return o(n);o(e,t.transactions,c)}await Promise.all(b),t.header.transactionsTrie=h.toBuffer(g.root),t.header.receiptTrie=h.toBuffer(m.root),n?i.putBlock(t,p,f,done):done()})},BlockchainDouble.prototype.processNextBlock=function(e,t){var n=this;"function"==typeof e&&(t=e,e=void 0),n.sortByPriceAndNonce();for(var o=[],i=0,a=r.number(n.blockGasLimit);n.pending_transactions.length>0;){var s=n.pending_transactions[0],c=r.number(s.gasLimit);if(!(i+c<=a))break;i+=c,n.pending_transactions.shift(),o.push(s)}if(0===o.length&&n.pending_transactions.length>0){return t("Unexpected error condition: next transaction exceeds block gas limit")}this.createBlock(function(i,a){if(i)return t(i);e&&(n.data.blocks.last(function(t,o){t||o&&r.number(o.header.timestamp)>e&&n.logger.log("Waring: Setting the block timestamp ("+e+") that is earlier than the parent block one.")}),a.header.timestamp=r.hex(e),n.setTime(new Date(1e3*e))),Array.prototype.push.apply(a.transactions,o),n.processBlock(n.vm,a,!0,t)})},BlockchainDouble.prototype.processTransactionTrace=async function(e,t,n){const o=this,i=r.hex(e);let a,s="",c=null,u={currentDepth:-1,stack:[]},l={gas:0,returnValue:"",structLogs:[]};function stepListener(e,n){const i=r.number(e.gasLeft),s=r.number(c.gasLimit)-i-l.gas;l.gas+=s;let h=null;if(!t.disableMemory&&(h=(h=Buffer.from(e.memory).toString("hex")).match(/.{1,64}/g)||[]).length>0){const e=h[h.length-1];e.length<64&&(h[h.length-1]=e+new Array(64-e.length+1).join("0"))}let p=null;t.disableStack||(p=e.stack.map(e=>r.rpcDataHexString(e,64).replace("0x","")));let f={depth:e.depth,error:"",gas:i,gasCost:s,memory:h,op:e.opcode.name,pc:e.pc,stack:p,storage:null};t.disableStorage?(l.structLogs.push(f),n()):f=o.processStorageTrace(f,u,e,a,function(e,t){if(e)return n(e);l.structLogs.push(t),n()})}this.getTransactionReceipt(i,function(e,t){if(e)return n(e);if(!t)return n(new Error("Unknown transaction "+i));let u=t.block;o.getBlock(u.header.parentHash,function(e,t){if(e)return n(e);var h=o.createStateTrie(o.data.trie_db,t.header.stateRoot,{forkBlockNumber:r.number(t.header.number)});a=o.createVMFromStateTrie(h),o.createBlock(t,!1,function(e,t){if(e)return n(e);for(var h=0;h<u.transactions.length;h++){var p=u.transactions[h];if(t.transactions.push(p),r.hex(p.hash())===i)break}function beforeTxListener(e){c=e,(s=r.hex(e.hash()))===i&&a.on("step",stepListener)}function afterTxListener(){s===i&&removeListeners()}function removeListeners(){a.removeListener("step",stepListener),a.removeListener("beforeTx",beforeTxListener),a.removeListener("afterTx",afterTxListener)}a.on("beforeTx",beforeTxListener),a.on("afterTx",afterTxListener),a.stateManager._cache.flush=e=>e(),o.processBlock(a,t,!1,function(e){e&&0===e.message.indexOf("VM Exception")&&(e=null),removeListeners(),n(e,l)})})})})},BlockchainDouble.prototype.processStorageTrace=function(e,t,n,o,i){var a,s,c=n.opcode.name;switch(t.currentDepth>n.depth&&t.stack.pop(),t.currentDepth<n.depth&&t.stack.push({}),t.currentDepth=n.depth,c){case"SSTORE":{const o=n.stack,c=o.length;a=r.rpcDataHexString(o[c-1],64).replace("0x",""),s=r.rpcDataHexString(o[c-2],64).replace("0x",""),e.storage=Object.assign({},t.stack[t.currentDepth]),i(null,e),t.stack[t.currentDepth][a]=s}break;case"SLOAD":{const c=n.stack;a=r.rpcDataHexString(c[c.length-1],64).replace("0x",""),o.stateManager.getContractStorage(n.address,"0x"+a,function(n,o){if(n)return i(n);s=r.rpcDataHexString(o,64).replace("0x",""),t.stack[t.currentDepth][a]=s,e.storage=Object.assign({},t.stack[t.currentDepth]),i(null,e)})}break;default:e.storage=Object.assign({},t.stack[t.currentDepth]),i(null,e)}},BlockchainDouble.prototype.getAccount=function(e,t,n){var r=this;this.getBlock(t,function(t,i){if(t)return n(t);var a=r.stateTrie,s=a.root;r.stateTrie.root=i.header.stateRoot,a.get(h.toBuffer(e),function(e,t){if(a.root=s,e)return n(e);var r=new o(t);n(null,r)})})},BlockchainDouble.prototype.getNonce=function(e,t,n){this.getAccount(e,t,function(e,t){if(e)return n(e);n(null,t.nonce)})},BlockchainDouble.prototype.getBalance=function(e,t,n){this.getAccount(e,t,function(e,t){if(e)return n(e);n(null,t.balance)})},BlockchainDouble.prototype.getStorage=function(e,t,n,r){var i=this;this.getBlock(n,function(n,a){if(n)return r(n);var s=i.stateTrie,c=s.root;i.stateTrie.root=a.header.stateRoot,s.get(h.toBuffer(e),function(e,n){if(null!=e)return s.root=c,r(e);var i=new o(n);s.root=i.stateRoot,s.get(h.setLengthLeft(h.toBuffer(t),32),function(e,t){if(s.root=c,null!=e)return r(e);r(null,t)})})})},BlockchainDouble.prototype.getCode=function(e,t,n){var r=this;this.getBlock(t,function(t,i){if(t)return n(t);var a=r.stateTrie,s=a.root;r.stateTrie.root=i.header.stateRoot,a.get(h.toBuffer(e),function(e,t){if(null!=e)return a.root=s,n(e);new o(t).getCode(a,function(e,t){if(a.root=s,e)return n(e);n(null,t)})})})},BlockchainDouble.prototype.getTransaction=function(e,t){e=r.hex(e),this.data.transactions.get(e,function(e,n){if(e)return e.notFound?t(null,null):t(e);t(null,n)})},BlockchainDouble.prototype.getTransactionReceipt=function(e,t){e=r.hex(e);const n=this.pending_transactions;for(var o=0;o<n.length;o++){if(e===r.hex(n[o].hash()))return t(null,{tx:n[o]})}this.data.transactionReceipts.get(e,function(e,n){if(e)return e.notFound?t(null,null):t(e);t(e,n)})},BlockchainDouble.prototype.getBlockLogs=function(e,t){var n=this;this.getEffectiveBlockNumber(e,function(e,r){if(e)return t(e);n.data.blockLogs.get(r,t)})},BlockchainDouble.prototype.getHeight=function(e){this.data.blocks.length(function(t,n){if(t)return e(t);e(null,n-1)})},BlockchainDouble.prototype.currentTime=function(){return((new Date).getTime()/1e3|0)+this.timeAdjustment},BlockchainDouble.prototype.increaseTime=function(e){return e<0&&(e=0),this.timeAdjustment+=e,this.timeAdjustment},BlockchainDouble.prototype.setTime=function(e){var t=(new Date).getTime()/1e3|0,n=e.getTime()/1e3|0;this.timeAdjustment=n-t},BlockchainDouble.prototype.close=function(e){this.data.close(e)},e.exports=BlockchainDouble},function(e,t){e.exports=require("merkle-patricia-tree")},function(e,t){e.exports=require("level-sublevel")},function(e,t){e.exports=require("fs")},function(e,t,n){var r=n(9);e.exports={encode:function(e,t){t(null,e.encode())},decode:function(e,t){const n={hash:e.hash,nonce:e.nonce,value:e.value,to:e.to,from:e.from,gasLimit:e.gas||e.gasLimit,gasPrice:e.gasPrice,data:e.data,v:e.v,r:e.r,s:e.s},o=void 0===e._type?r.types.fake:e._type;t(null,r.fromJSON(n,o))}}},function(e,t){e.exports=require("web3-core-helpers")},function(e,t){e.exports=require("web3-core-method")},function(e,t){e.exports=require("web3-net")},function(e,t){e.exports=require("web3-eth-personal")},function(e,t,n){function TXRejectedError(e){Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.message=e}(0,n(1).inherits)(TXRejectedError,Error),e.exports=TXRejectedError},function(e,t,n){var r=n(0);e.exports={toJSON:function(e,t){return{number:r.rpcQuantityHexString(e.header.number),hash:r.hex(e.hash()),parentHash:r.hex(e.header.parentHash),mixHash:r.hex(e.header.mixHash),nonce:r.rpcDataHexString(r.hex(e.header.nonce),16),sha3Uncles:r.hex(e.header.uncleHash),logsBloom:r.hex(e.header.bloom),transactionsRoot:r.hex(e.header.transactionsTrie),stateRoot:r.hex(e.header.stateRoot),receiptsRoot:r.hex(e.header.receiptTrie),miner:r.hex(e.header.coinbase),difficulty:r.rpcQuantityHexString(e.header.difficulty),totalDifficulty:r.rpcQuantityHexString(e.header.difficulty),extraData:r.rpcDataHexString(e.header.extraData),size:r.hex(1e3),gasLimit:r.rpcQuantityHexString(e.header.gasLimit),gasUsed:r.rpcQuantityHexString(e.header.gasUsed),timestamp:r.rpcQuantityHexString(e.header.timestamp),transactions:e.transactions.map(function(n){return t?n.toJsonRpc(e):r.hex(n.hash())}),uncles:[]}}}},function(e,t,n){n(6);const r=n(20),o=n(102);e.exports={server:function(e){return o.create(e)},provider:function(e){return new r(e)},_webpacked:!0}},function(e,t){e.exports=require("web3-provider-engine")},function(e,t){e.exports=require("web3-provider-engine/subproviders/subscriptions")},function(e,t,n){var r=n(4);function RequestFunnel(){this.methods={eth_call:!0,eth_getStorageAt:!0,eth_sendTransaction:!0,eth_sendRawTransaction:!0,eth_newBlockFilter:!0,eth_getFilterChanges:!0,eth_getFilterLogs:!0},this.queue=[],this.isWorking=!1}(0,n(1).inherits)(RequestFunnel,r),e.exports=RequestFunnel,RequestFunnel.prototype.handleRequest=function(e,t,n){if(!0!==e.external||!0!==this.methods[e.method])return t();this.queue.push([e,t]),!1===this.isWorking&&this.processNext()},RequestFunnel.prototype.processNext=function(){var e=this;0!==this.queue.length?(this.isWorking=!0,(0,this.queue.shift()[1])(function(t,n,r){if(t)return r(t);r(),e.processNext()})):this.isWorking=!1}},function(e,t,n){var r=n(4),o=n(1).inherits,i=n(2),a=n(0);function DelayedBlockFilter(){this.watching={}}o(DelayedBlockFilter,r),e.exports=DelayedBlockFilter,DelayedBlockFilter.prototype.handleRequest=function(e,t,n){return"eth_newBlockFilter"===e.method?this.handleNewBlockFilter(e,t,n):"eth_getFilterChanges"===e.method?this.handleGetFilterChanges(e,t,n):void t()},DelayedBlockFilter.prototype.handleNewBlockFilter=function(e,t,n){var r=this;t(function(e,t,n){if(e)return n();r.watching[t]=!0,n()})},DelayedBlockFilter.prototype.handleGetFilterChanges=function(e,t,n){var r=this,o=e.params[0];if(!this.watching[o])return t();t(function(e,t,n){if(e)return n();var s,c,u;i.series([function(e){0!==t.length?(s=t[0],e()):r.emitPayload({method:"eth_blockNumber"},function(t,n){if(t)return e(t);u=a.number(n.result),e()})},function(e){if(u)return e();r.emitPayload({method:"eth_getBlockByHash",params:[s,!1]},function(t,n){if(t)return e(t);u=a.number(n.result.number),e()})},function(e){if(0===(u=a.number(u)))return c=void 0,e();u-=1,r.emitPayload({method:"eth_getBlockByNumber",params:[u,!1]},function(t,n){if(t)return e(t);c=n.result.hash,e()})}],function(e){c&&(t[0]=c),delete r.watching[o],n()})})}},function(e,t,n){var r=n(4);function GethDefaults(){}(0,n(1).inherits)(GethDefaults,r),e.exports=GethDefaults,GethDefaults.prototype.handleRequest=function(e,t,n){if("eth_estimateGas"!==e.method&&"eth_call"!==e.method)return t();var r=e.params[0];null==r.from?this.emitPayload({method:"eth_coinbase"},function(e,o){if(e)return n(e);var i=o.result;r.from=i,t()}):t()}},function(e,t,n){var r=n(3),o=n(1).inherits,i=n(40),a=n(0),s=n(31),c=n(32),u=n(100);const{BlockOutOfRangeError:l}=n(14);var h=n(4);const p="0x"+Number.MAX_SAFE_INTEGER.toString(16);function GethApiDouble(e,t){var n=this;this.state=e.state||new i(e,t),this.options=e,this.initialized=!1,this.initialization_error=null,this.post_initialization_callbacks=[],this.state.initialize(function(e){e&&(n.initialization_error=e),n.initialized=!0;var t=n.post_initialization_callbacks;n.post_initialization_callbacks=[],t.forEach(function(e){setImmediate(function(){e(n.initialization_error,n.state)})})})}o(GethApiDouble,h),GethApiDouble.prototype.waitForInitialization=function(e){!1===this.initialized?this.post_initialization_callbacks.push(e):e(this.initialization_error,this.state)},GethApiDouble.prototype.handleRequest=function(e,t,n){if(null!=this.initialization_error)return n(this.initialization_error);if(!1!==this.initialized){var r=this[e.method];if(null==r)return n(new Error("Method "+e.method+" not supported."));var o=e.params||[],i=[].concat(o),a=!1;if(this.requiresDefaultBlockParameter(e.method)&&i.length<r.length-1&&(i.push("latest"),a=!0),i.push(n),i.length>r.length||void 0!==r.minLength&&i.length<r.minLength||void 0===r.minLength&&i.length<r.length){var s=`Incorrect number of arguments. Method '${e.method}' requires `;return r.minLength?s+=`between ${r.minLength-1} and ${r.length-1} arguments. `:s+=`exactly ${r.length-1} arguments. `,s+=a?"Including the implicit block argument, r":"R",s+=`equest specified ${i.length-1} arguments: ${JSON.stringify(i)}.`,n(new Error(s))}r.apply(this,i)}else this.waitForInitialization(this.getDelayedHandler(e,t,n))},GethApiDouble.prototype.getDelayedHandler=function(e,t,n){var r=this;return function(o,i){o&&n(o),r.handleRequest(e,t,n)}},GethApiDouble.prototype.requiresDefaultBlockParameter=function(e){return!0==={eth_getBalance:!0,eth_getCode:!0,eth_getTransactionCount:!0,eth_getStorageAt:!0,eth_call:!0,eth_estimateGas:!0}[e]},GethApiDouble.prototype.eth_accounts=function(e){e(null,Object.keys(this.state.accounts))},GethApiDouble.prototype.eth_blockNumber=function(e){this.state.blockNumber(function(t,n){if(t)return e(t);e(null,a.hex(n))})},GethApiDouble.prototype.eth_chainId=function(e){e(null,a.hex(1337))},GethApiDouble.prototype.eth_coinbase=function(e){e(null,this.state.coinbase)},GethApiDouble.prototype.eth_mining=function(e){e(null,this.state.is_mining)},GethApiDouble.prototype.eth_hashrate=function(e){e(null,"0x0")},GethApiDouble.prototype.eth_gasPrice=function(e){e(null,r.addHexPrefix(this.state.gasPrice()))},GethApiDouble.prototype.eth_getBalance=function(e,t,n){this.state.getBalance(e,t,n)},GethApiDouble.prototype.eth_getCode=function(e,t,n){this.state.getCode(e,t,n)},GethApiDouble.prototype.eth_getBlockByNumber=function(e,t,n){this.state.blockchain.getBlock(e,function(e,r){if(e)return e instanceof l?n(null,null):n(e);n(null,c.toJSON(r,t))})},GethApiDouble.prototype.eth_getBlockByHash=function(e,t,n){this.eth_getBlockByNumber.apply(this,arguments)},GethApiDouble.prototype.eth_getBlockTransactionCountByNumber=function(e,t){this.state.blockchain.getBlock(e,function(e,n){if(e)return e instanceof l?t(null,null):t(e);t(null,a.rpcQuantityHexString(n.transactions.length))})},GethApiDouble.prototype.eth_getBlockTransactionCountByHash=function(e,t){this.eth_getBlockTransactionCountByNumber.apply(this,arguments)},GethApiDouble.prototype.eth_getTransactionReceipt=function(e,t){this.state.getTransactionReceipt(e,function(e,n){if(e)return t(e);var r=null;n&&n.block&&(r=n.toJSON()),t(null,r)})},GethApiDouble.prototype.eth_getTransactionByHash=function(e,t){this.state.getTransactionReceipt(e,function(e,n){if(e)return t(e);var r=null;n&&(n.block?r=n.tx.toJsonRpc(n.block):(n.block={transactions:[],hash:()=>null,header:{number:null}},r=n.tx.toJsonRpc(n.block))),t(null,r)})},GethApiDouble.prototype.eth_getTransactionByBlockHashAndIndex=function(e,t,n){t=a.number(t),this.state.getBlock(e,function(e,r){if(e)return e.notFound?n(null,null):n(e);if(t>=r.transactions.length)return n(new Error("Transaction at index "+a.hex(t)+" does not exist in block."));var o=r.transactions[t].toJsonRpc(r);n(null,o)})},GethApiDouble.prototype.eth_getTransactionByBlockNumberAndIndex=function(e,t,n){this.eth_getTransactionByBlockHashAndIndex(e,t,n)},GethApiDouble.prototype.eth_getTransactionCount=function(e,t,n){this.state.getTransactionCount(e,t,(e,t)=>e instanceof l?n(null,null):n(e,t))},GethApiDouble.prototype.eth_sign=function(e,t,n){var r,o;try{r=this.state.sign(e,t)}catch(e){o=e}n(o,r)},GethApiDouble.prototype.eth_signTypedData=function(e,t,n){var r,o;try{r=this.state.signTypedData(e,t)}catch(e){o=e}n(o,r)},GethApiDouble.prototype.eth_sendTransaction=function(e,t){this.state.queueTransaction("eth_sendTransaction",e,null,t)},GethApiDouble.prototype.eth_sendRawTransaction=function(e,t){let n;if(e&&(n=a.buffer(e)),void 0===n)throw new s("rawTx must be a string, JSON-encoded Buffer, or Buffer.");this.state.queueRawTransaction(n,t)},GethApiDouble.prototype._setCallGasLimit=function(e){if(!e.gas&&!e.gasLimit){const t=this.options.callGasLimit;e.gas=null!=t?t:p}},GethApiDouble.prototype.eth_call=function(e,t,n){this._setCallGasLimit(e),this.state.queueTransaction("eth_call",e,t,n)},GethApiDouble.prototype.eth_estimateGas=function(e,t,n){this._setCallGasLimit(e),this.state.queueTransaction("eth_estimateGas",e,t,n)},GethApiDouble.prototype.eth_getStorageAt=function(e,t,n,r){this.state.queueStorage(e,t,n,r)},GethApiDouble.prototype.eth_newBlockFilter=function(e){var t=r.addHexPrefix(r.intToHex(this.state.latestFilterId));this.state.latestFilterId+=1,e(null,t)},GethApiDouble.prototype.eth_getFilterChanges=function(e,t){var n=this.state.latestBlock().hash().toString("hex");this.state.mine(),t(null,[n])},GethApiDouble.prototype.eth_getLogs=function(e,t){this.state.getLogs(e,t)},GethApiDouble.prototype.eth_uninstallFilter=function(e,t){t(null,!0)},GethApiDouble.prototype.eth_protocolVersion=function(e){e(null,"63")},GethApiDouble.prototype.bzz_hive=function(e){e(null,[])},GethApiDouble.prototype.bzz_info=function(e){e(null,[])},GethApiDouble.prototype.shh_version=function(e){e(null,"2")},GethApiDouble.prototype.eth_getCompilers=function(e){e(null,[])},GethApiDouble.prototype.eth_syncing=function(e){e(null,!1)},GethApiDouble.prototype.net_listening=function(e){e(null,!0)},GethApiDouble.prototype.net_peerCount=function(e){e(null,0)},GethApiDouble.prototype.web3_clientVersion=function(e){e(null,"EthereumJS TestRPC/v"+u.version+"/ethereum-js")},GethApiDouble.prototype.web3_sha3=function(e,t){t(null,a.hex(r.keccak256(e)))},GethApiDouble.prototype.net_version=function(e){e(null,this.state.net_version+"")},GethApiDouble.prototype.miner_start=function(e,t){t||"function"!=typeof e||(t=e,e=null),this.state.startMining(function(e){t(e,!0)})},GethApiDouble.prototype.miner_start.minLength=1,GethApiDouble.prototype.miner_stop=function(e){this.state.stopMining(function(t){e(t,!0)})},GethApiDouble.prototype.rpc_modules=function(e){e(null,{eth:"1.0",net:"1.0",rpc:"1.0",web3:"1.0",evm:"1.0",personal:"1.0"})},GethApiDouble.prototype.personal_listAccounts=function(e){e(null,Object.keys(this.state.personal_accounts))},GethApiDouble.prototype.personal_newAccount=function(e,t){var n=this.state.createAccount({generate:!0});this.state.accounts[n.address.toLowerCase()]=n,this.state.personal_accounts[n.address.toLowerCase()]=!0,this.state.account_passwords[n.address.toLowerCase()]=e,t(null,n.address)},GethApiDouble.prototype.personal_importRawKey=function(e,t,n){var r=this.state.createAccount({secretKey:e});this.state.accounts[r.address.toLowerCase()]=r,this.state.personal_accounts[r.address.toLowerCase()]=!0,this.state.account_passwords[r.address.toLowerCase()]=t,n(null,r.address)},GethApiDouble.prototype.personal_lockAccount=function(e,t){if(!0!==this.state.personal_accounts[e.toLowerCase()]){return t("Account not found")}delete this.state.unlocked_accounts[e.toLowerCase()],t(null,!0)},GethApiDouble.prototype.personal_unlockAccount=function(e,t,n,r){if(!0!==this.state.personal_accounts[e.toLowerCase()]){return r("Account not found")}var o=this.state.account_passwords[e.toLowerCase()];if(void 0!==o&&o!==t){return r("Invalid password")}this.state.unlocked_accounts[e.toLowerCase()]=!0,r(null,!0)},GethApiDouble.prototype.personal_sendTransaction=function(e,t,n){if(null!=e.from){var o=r.addHexPrefix(e.from).toLowerCase(),i=this;i.personal_unlockAccount(o,t,null,function(t){if(t)return n(t);i.state.queueTransaction("eth_sendTransaction",e,null,function(e,t){i.state.unlocked_accounts[o.toLowerCase()]=!1,n(e,t)})})}else{n("Sender not found")}},GethApiDouble.prototype.evm_snapshot=function(e){this.state.snapshot(e)},GethApiDouble.prototype.evm_revert=function(e,t){this.state.revert(e,t)},GethApiDouble.prototype.evm_increaseTime=function(e,t){t(null,this.state.blockchain.increaseTime(e))},GethApiDouble.prototype.evm_setTime=function(e,t){t(null,this.state.blockchain.setTime(e))},GethApiDouble.prototype.evm_mine=function(e,t){"function"==typeof e&&(t=e,e=void 0),this.state.processBlock(e,function(e){if(e)return t(e);t(e,"0x0")})},GethApiDouble.prototype.evm_mine.minLength=1,GethApiDouble.prototype.debug_traceTransaction=function(e,t,n){"function"==typeof t&&(n=t,t=[]),this.state.queueTransactionTrace(e,t,n)},GethApiDouble.prototype.eth_getUncleCountByBlockHash=function(e,t){t(null,"0x0")},GethApiDouble.prototype.eth_getUncleCountByBlockNumber=function(e,t){t(null,"0x0")},GethApiDouble.prototype.eth_getUncleByBlockHashAndIndex=function(e,t,n){n(null,{})},GethApiDouble.prototype.eth_getUncleByBlockNumberAndIndex=function(e,t,n){n(null,{})},GethApiDouble.prototype.eth_getWork=function(e,t){t(null,[])},GethApiDouble.prototype.eth_submitWork=function(e,t,n,r){r(null,!1)},GethApiDouble.prototype.eth_submitHashrate=function(e,t,n){n(null,!1)},GethApiDouble.prototype.db_putString=function(e,t,n,r){r(null,!1)},GethApiDouble.prototype.db_getString=function(e,t,n){n(null,"")},GethApiDouble.prototype.db_putHex=function(e,t,n,r){r(null,!1)},GethApiDouble.prototype.db_getHex=function(e,t,n){n(null,"0x00")},GethApiDouble.prototype.shh_post=function(e,t,n,r,o,i,a){a(null,!1)},GethApiDouble.prototype.shh_newIdentity=function(e){e(null,"0x00")},GethApiDouble.prototype.shh_hasIdentity=function(e,t){t(null,!1)},GethApiDouble.prototype.shh_newGroup=function(e){e(null,"0x00")},GethApiDouble.prototype.shh_addToGroup=function(e,t){t(null,!1)},GethApiDouble.prototype.shh_newFilter=function(e,t,n){n(null,!1)},GethApiDouble.prototype.shh_uninstallFilter=function(e,t){t(null,!1)},GethApiDouble.prototype.shh_getFilterChanges=function(e,t){t(null,[])},GethApiDouble.prototype.shh_getMessages=function(e,t){t(null,!1)},e.exports=GethApiDouble},function(e,t,n){var r=n(7).default,o=n(8),i=n(9),a=n(3),s=n(45),c=n(46),u=n(21),l=n(52),h=n(2),p=n(22),f=n(71),d=n(16),g=n(25),m=n(98),b=n(5);const{BlockOutOfRangeError:y}=n(14),k=a.BN,v=Buffer.from([0]);var x=n(0),_=n(99),w=n(31);function StateManager(e,t){this.options=e=this._applyDefaultOptions(e||{}),e.fork?this.blockchain=new f(e):this.blockchain=new p(e),this.vm=this.blockchain.vm,this.stateTrie=this.blockchain.stateTrie,this.accounts={},this.secure=!!e.secure,this.account_passwords={},this.personal_accounts={},this.total_accounts=e.total_accounts,this.coinbase=null,this.latest_filter_id=1,this.action_queue=[],this.action_processing=!1,this.snapshots=[],this.logger=e.logger,this.net_version=e.network_id,this.mnemonic=e.mnemonic,this.wallet=l.fromMasterSeed(c.mnemonicToSeed(this.mnemonic)),this.wallet_hdpath=e.hdPath,this.gasPriceVal=x.rpcQuantityHexString(e.gasPrice),this.is_mining=!0,this.blockTime=e.blockTime,this.is_mining_on_interval=!!e.blockTime,this.mining_interval_timeout=null,this._provider=t}const B={total_accounts:10,gasPrice:"0x77359400",default_balance_ether:100,unlocked_accounts:[],hdPath:"m/44'/60'/0'/0/"};StateManager.prototype._applyDefaultOptions=function(e){if(e.seed||(e.seed=_.randomAlphaNumericString(10,s())),!e.mnemonic){let t=_.randomBytes(16,s(e.seed));e.mnemonic=c.entropyToMnemonic(t.toString("hex"))}return e.fork||e.network_id||(e.network_id=(new Date).getTime()),b.merge(e,B,Object.assign({},e))},StateManager.prototype.initialize=function(e){var t=this,n=[];let r=x.hex(d.utils.toWei(t.options.default_balance_ether.toString(),"ether"));if(t.options.accounts)n=t.options.accounts.map(t.createAccount.bind(t));else{if(!t.total_accounts)return e(new Error("Cannot initialize chain: either options.accounts or options.total_accounts must be specified"));for(var o=0;o<t.total_accounts;o++)n.push(t.createAccount({index:o,balance:r}))}if(t.coinbase=x.hex(n[0].address),t.accounts={},n.forEach(function(e){t.accounts[e.address]=e,t.personal_accounts[e.address.toLowerCase()]=!0}),t.unlocked_accounts=t.options.unlocked_accounts.reduce(function(e,t){if(0!==(t+"").indexOf("0x")){let e=parseInt(t),r=n[e];if(!r)throw new Error(`Account at index ${e} not found. Max index available is ${n.length-1}.`);t=r.address.toLowerCase()}return e[t.toLowerCase()]=!0,e},{}),t.secure||n.forEach(function(e){t.unlocked_accounts[e.address.toLowerCase()]=e}),t.options.account_keys_path){const e={addresses:{},private_keys:{}};n.forEach(function(t){e.private_keys[t.address]=t.secretKey.toString("hex"),e.addresses[t.address]=t});const r=JSON.stringify(e);g.writeFileSync(t.options.account_keys_path,r,"utf8")}t.blockchain.initialize(n,function(n){if(n)return e(n);t.net_version||(t.net_version=t.blockchain.forkVersion),t.is_mining_on_interval&&t.mineOnInterval(),e()})},StateManager.prototype._minerCancellationToken=null,StateManager.prototype.mineOnInterval=function(){if(clearTimeout(this.mining_interval_timeout),null!==this._minerCancellationToken&&(this._minerCancellationToken.cancelled=!0),!this.is_mining)return void this.logger.log("Warning: mineOnInterval called when miner was stopped");const e={cancelled:!1};this._minerCancellationToken=e;const t=this.mining_interval_timeout=setTimeout(this._provider.send.bind(this._provider),1e3*this.blockTime,{method:"evm_mine"},()=>{e.cancelled||this.mineOnInterval.bind(this)()});"function"==typeof t.unref&&t.unref()},StateManager.prototype.createAccount=function(e,t){var n;if(e.generate)n=u.generate().getPrivateKey();else if(e.secretKey)n=a.toBuffer(x.hex(e.secretKey));else{var o=void 0===e.index?t:e.index;n=this.wallet.derivePath(this.wallet_hdpath+o).getWallet().getPrivateKey()}var i=a.privateToPublic(n),s=a.publicToAddress(i),c=new r;return c.balance=x.hex(e.balance),{secretKey:n,publicKey:i,address:x.hex(s).toLowerCase(),account:c}},StateManager.prototype.blockNumber=function(e){return this.blockchain.getHeight(e)},StateManager.prototype.gasPrice=function(){return this.gasPriceVal},StateManager.prototype.getBalance=function(e,t,n){this.blockchain.getBalance(e,t,function(e,t){t&&(t=x.rpcQuantityHexString(t)),n(e,t)})},StateManager.prototype.getTransactionCount=function(e,t,n){this.blockchain.getNonce(e,t,function(e,t){t&&(t=x.rpcQuantityHexString(t)),n(e,t)})},StateManager.prototype.getCode=function(e,t,n){this.blockchain.getCode(e,t,function(e,t){t&&(t=x.hex(t)),n(e,t)})},StateManager.prototype.queueRawTransaction=function(e,t){const n=new i(e,i.types.signed),r=x.hex(n.from).toLowerCase();this._queueTransaction("eth_sendRawTransaction",n,r,null,t)},StateManager.prototype.queueStorage=function(e,t,n,r){this.action_queue.push({method:"eth_getStorageAt",address:a.addHexPrefix(e),position:a.addHexPrefix(t),block:n,callback:r}),this.processNextAction()},StateManager.prototype.queueTransaction=function(e,t,n,r){const o=t.from?x.hex(t.from).toLowerCase():null;if(null==o)return void r(new w("from not found; is required"));if(t.to&&"string"!=typeof t.to)return r(new w("Invalid to address"));const a=this.accounts.hasOwnProperty(o);if("eth_sendTransaction"===e&&!this.unlocked_accounts.hasOwnProperty(o)){return r(new w(a?"signer account is locked":"sender account not recognized"))}let s,c=i.types.none;a&&"eth_call"!==e||(c|=i.types.fake);try{s=i.fromJSON(t,c),this._setTransactionDefaults(s,"eth_sendTransaction"===e)}catch(e){return void r(e)}this._queueTransaction(e,s,o,n,r)},StateManager.prototype._setTransactionDefaults=function(e,t){t&&0===e.gasLimit.length&&(e.gasLimit=a.toBuffer(this.blockchain.defaultTransactionGasLimit)),0===e.gasPrice.length&&(e.gasPrice=a.toBuffer(this.gasPriceVal)),0===e.value.length&&(e.value=Buffer.from([0])),(0===e.to.length||e.to.equals(v))&&(e.to=Buffer.allocUnsafe(0))},StateManager.prototype._queueTransaction=function(e,t,n,r,o){if(!(t instanceof i))throw new w("tx must be of type Transaction");if(("eth_sendRawTransaction"===e||"eth_sendTransaction"===e)&&x.number(t.gasLimit)>x.number(this.blockchain.blockGasLimit))return o(new w("Exceeds block gas limit"));this.action_queue.push({method:e,from:n,tx:t,callback:o,blockNumber:r}),this.processNextAction()},StateManager.prototype.queueTransactionTrace=function(e,t,n){this.action_queue.push({method:"debug_traceTransaction",hash:x.hex(e),params:t,callback:n}),this.processNextAction()},StateManager.prototype.processNextAction=function(e){var t=this;if(!0===e||!0!==this.action_processing&&0!==this.action_queue.length){var n=this.action_queue.shift();this.action_processing=!0;var r=function(e,r){n.callback(e,r),t.action_queue.length>0?t.processNextAction(!0):t.action_processing=!1};if("function"==typeof n.method){var o=n.method();return r(null,o)}"eth_getStorageAt"===n.method?this.blockchain.getStorage(n.address,n.position,n.block,function(e,t){if(e)return r(e);t&&(t=a.rlp.decode(t)),t=x.hex(t||0),r(null,t)}):"debug_traceTransaction"===n.method?this.blockchain.processTransactionTrace(n.hash,n.params,r):"eth_sendTransaction"===n.method||"eth_sendRawTransaction"===n.method?this.processTransaction(n.from,n.tx,r):"eth_call"===n.method?this.processCall(n.from,n.tx,n.blockNumber,r):"eth_estimateGas"===n.method&&this.processGasEstimate(n.from,n.tx,n.blockNumber,r)}},StateManager.prototype.sign=function(e,t){var n=this.accounts[x.hex(e).toLowerCase()];if(!n)throw new Error("cannot sign data; no private key");var r=n.secretKey,o=x.buffer(t,"hex"),i=a.hashPersonalMessage(o),s=a.ecsign(i,Buffer.from(r));const c=s.v-27,u=(c-35)/2;return a.toRpcSig(c,s.r,s.s,u)},StateManager.prototype.signTypedData=function(e,t){var n=this.accounts[x.hex(e).toLowerCase()];if(!n)throw new Error("cannot sign data; no private key");if(!t.types)throw new Error("cannot sign data; types missing");if(!t.types.EIP712Domain)throw new Error("cannot sign data; EIP712Domain definition missing");if(!t.domain)throw new Error("cannot sign data; domain missing");if(!t.primaryType)throw new Error("cannot sign data; primaryType missing");if(!t.message)throw new Error("cannot sign data; message missing");return m.signTypedData_v4(n.secretKey,{data:t})},StateManager.prototype.printTransactionReceipt=function(e,t,n){var r=this;r.blockchain.getTransactionReceipt(e,function(o,i){if(o)return n(o);r.blockchain.latestBlock(function(o,a){if(o)return n(o);i=i.toJSON(),r.logger.log(""),r.logger.log("  Transaction: "+e),null!=i.contractAddress&&r.logger.log("  Contract created: "+i.contractAddress),r.logger.log("  Gas usage: "+parseInt(i.gasUsed,16)),r.logger.log("  Block Number: "+parseInt(i.blockNumber,16)),r.logger.log("  Block Time: "+new Date(1e3*x.number(a.header.timestamp)).toString()),t&&(r.logger.log("  Runtime Error: "+t.error),t.reason&&r.logger.log("  Revert reason: "+t.reason)),r.logger.log(""),n(null,e)})})},StateManager.prototype.processBlock=function(e,t){var n=this;"function"==typeof e&&(t=e,e=null),n.blockchain.processNextBlock(e,function(e,r,i){if(e&&e instanceof o==!1)return t(e,r,i);h.eachSeries(r,function(t,r){var o=x.hex(t.hash()),i=null==e?{results:{}}:e;n.printTransactionReceipt(o,i.results[o],r)},t(e,r,i))})},StateManager.prototype.processBlocks=function(e,t){var n=this;"function"==typeof e&&(t=e,e=null);var r=null,i=0;h.whilst(function(){return null==e?n.blockchain.pending_transactions.length>0:i<e},function(e){n.processBlock(function(t,n,a){if(i+=1,t){if(t instanceof o==!1)return e(t);null==r?r=t:r.combine(t)}e()})},function(e){t(e||r)})},StateManager.prototype.processCall=function(e,t,n,r){var o=this;o.createTransactionWithCorrectNonce(t,e,function(e,t){if(e)return r(e);o.blockchain.processCall(t,n,function(e,t){if(e)return e instanceof y?r(null,null):r(e);var n="0x";return!t.error&&t.vm.return?n=x.hex(t.vm.return):t.error&&o.logger.log(`Error processing call: ${t.error}`),r(null,n)})})},StateManager.prototype.processGasEstimate=function(e,t,n,r){var o=this;o.createTransactionWithCorrectNonce(t,e,function(e,t){if(e)return r(e);o.blockchain.estimateGas(t,n,function(e,t){if(e)return r(e);var n="0x";return t.error?o.logger.log(`Error calculating gas estimate: ${t.error}`):n=t.gasRefund?x.hex(t.gasEstimate.add(t.gasRefund)):x.hex(t.gasEstimate),r(null,n)})})},StateManager.prototype.processTransaction=function(e,t,n){var r=this;r.createTransactionWithCorrectNonce(t,e,function(e,t){if(e)return n(e);r.blockchain.queueTransaction(t);var o=x.hex(t.hash());if(!1===r.is_mining||r.is_mining_on_interval)return n(null,o);r.processBlocks(function(e){if(e)return n(e);n(null,o)})})},StateManager.prototype.getTransactionReceipt=function(e,t){this.blockchain.getTransactionReceipt(e,function(e,n){if(e&&e.notFound)return t(null,null);t(e,n)})},StateManager.prototype.getBlock=function(e,t){this.blockchain.getBlock(e,t)},StateManager.prototype.getLogs=function(e,t){var n=this,r=e.address&&(Array.isArray(e.address)?e.address:[e.address]);r=r&&r.map(function(e){return e.toLowerCase()});var o=e.topics||[];h.parallel({fromBlock:this.blockchain.getEffectiveBlockNumber.bind(this.blockchain,e.fromBlock||"latest"),toBlock:this.blockchain.getEffectiveBlockNumber.bind(this.blockchain,e.toBlock||"latest"),latestBlock:this.blockchain.getEffectiveBlockNumber.bind(this.blockchain,"latest")},function(e,i){if(e)return t(e);var a=i.fromBlock,s=i.toBlock,c=i.latestBlock;s>c&&(s=c);var u=[],l=a;h.whilst(function(){return l<=s},function(e){n.blockchain.getBlockLogs(l,function(t,n){if(t)return e(t);var i=r?n.filter(function(e){return r.indexOf(e.address.toLowerCase())>-1}):n;i=i.filter(function(e){for(var t=!0,n=0;n<o.length;n++){var r=o[n],i=e.topics[n];if(null!=r){var a=Array.isArray(r)?r.includes(i):r===i;if(n>=e.topics.length||!a){t=!1;break}}}return t}),u.push.apply(u,i),l+=1,e()})},function(e){if(e)return t(e);u=u.map(function(e){return e.toJSON()}),t(e,u)})})},StateManager.prototype.snapshot=function(e){var t=this;this.blockchain.getHeight(function(n,r){if(n)return e(n);t.snapshots.push({blockNumber:r,timeAdjustment:t.blockchain.timeAdjustment}),t.logger.log("Saved snapshot #"+t.snapshots.length),e(null,x.hex(t.snapshots.length))})},StateManager.prototype.revert=function(e,t){var n=this;if(null!=e){try{e=a.bufferToInt(e)}catch(e){return void t(e)}if(this.logger.log("Reverting to snapshot #"+e),e>this.snapshots.length||e<=0)return t(null,!1),!1;e-=1;var r=this.snapshots[e].timeAdjustment;h.whilst(function(){return n.snapshots.length>e},function(e){var t=n.snapshots.pop();h.during(function(e){n.blockchain.getHeight(function(n,r){if(n)return e(n);e(null,r>t.blockNumber)})},function(e){n.blockchain.popBlock(function(t){if(t)return e(t);e()})},e)},function(e){if(e)return t(e);n.blockchain.clearPendingTransactions(),n.blockchain.timeAdjustment=r,t(null,!0)})}else t(new Error("invalid snapshotId"))},StateManager.prototype.hasContractCode=function(e,t){this.vm.stateManager.getContractCode(e,function(e,n){null!=e?t(e,!1):t(null,!0)})},StateManager.prototype.startMining=function(e){if(this.is_mining)return process.nextTick(e),void this.logger.log("Warning: startMining called when miner was already started");this.is_mining=!0,this.is_mining_on_interval?(this.mineOnInterval(),process.nextTick(e)):this.processBlocks(e)},StateManager.prototype.stopMining=function(e){this.is_mining?(this._minerCancellationToken&&(this._minerCancellationToken.cancelled=!0,this._minerCancellationToken=null),this.is_mining=!1,clearTimeout(this.mining_interval_timeout),this.mining_interval_timeout=null):this.logger.log("Warning: stopMining called when miner was already stopped"),e&&process.nextTick(e)},StateManager.prototype.isUnlocked=function(e){return null!=this.unlocked_accounts[e.toLowerCase()]},StateManager.prototype.createTransactionWithCorrectNonce=function(e,t,n){this.blockchain.getQueuedNonce(t,(r,o)=>{if(r)return n(r);const i=(e,t)=>{if(e.validateNonce(t))return Promise.resolve(e);{const n=new k(t).toString(10),r=new k(e.nonce).toString(10);return Promise.reject(new w(`the tx doesn't have the correct nonce. account has nonce of: ${n} tx has nonce of: ${r}`))}},a=e=>n(null,e);if(e.isSigned())i(e,o).then(a).catch(n);else{const r=e=>{if(!e.isFake()&&!e.isSigned()){const n=this.accounts[t];n&&e.sign(n.secretKey)}return Promise.resolve(e)};0===e.nonce.length?(e.nonce=o,r(e).then(a)):i(e,o).then(r).then(a).catch(n)}})},e.exports=StateManager},function(e,t){e.exports=require("ethereumjs-abi")},function(e,t){e.exports=require("ethereumjs-tx")},function(e,t){e.exports=require("ethereumjs-tx/fake")},function(e,t){e.exports=require("assert")},function(e,t){e.exports=require("seedrandom")},function(e,t){e.exports=require("bip39")},function(e,t){e.exports=require("safe-buffer")},function(e,t){e.exports=require("randombytes")},function(e,t){e.exports=require("scrypt.js")},function(e,t){e.exports=require("uuid/v4")},function(e,t){e.exports=require("bs58check")},function(e,t,n){"use strict";var r=n(53),o=n(21);function EthereumHDKey(){}function fromHDKey(e){var t=new EthereumHDKey;return t._hdkey=e,t}EthereumHDKey.fromMasterSeed=function(e){return fromHDKey(r.fromMasterSeed(e))},EthereumHDKey.fromExtendedKey=function(e){return fromHDKey(r.fromExtendedKey(e))},EthereumHDKey.prototype.privateExtendedKey=function(){if(!this._hdkey.privateExtendedKey)throw new Error("This is a public key only wallet");return this._hdkey.privateExtendedKey},EthereumHDKey.prototype.publicExtendedKey=function(){return this._hdkey.publicExtendedKey},EthereumHDKey.prototype.derivePath=function(e){return fromHDKey(this._hdkey.derive(e))},EthereumHDKey.prototype.deriveChild=function(e){return fromHDKey(this._hdkey.deriveChild(e))},EthereumHDKey.prototype.getWallet=function(){return this._hdkey._privateKey?o.fromPrivateKey(this._hdkey._privateKey):o.fromPublicKey(this._hdkey._publicKey,!0)},e.exports=EthereumHDKey},function(e,t){e.exports=require("hdkey")},function(e,t){e.exports=require("ethereumjs-vm")},function(e,t){e.exports=require("heap")},function(e,t,n){var r=n(57),o=n(58),i=n(59),a=n(60),s=n(61),c=n(64),u=n(26),l=n(65),h=n(66),p=n(67),f=n(68),d=n(69);function Database(e){this.options=e,this.directory=null}Database.prototype.initialize=function(e){var t,n=this;function finishInitializing(t,i){if(t)return e(t);n.db=i,n.blocks=new r("blocks",n.db,l),n.blockLogs=new r("blockLogs",n.db,new p(n)),n.blockHashes=new o("blockHashes",n.db),n.transactions=new o("transactions",n.db,u),n.transactionReceipts=new o("transactionReceipts",n.db,new f(n)),n.trie_db=new o("trie_db",n.db,h,h),e()}t=function(t,r){if(t)return e(t);const o={valueEncoding:"json"};if(n.options.db){const e=n.options.db;i(e,o,finishInitializing)}else{n.directory=r;const e=a(c(r,s).maxSize(100),o);i(e,{},finishInitializing)}},n.options.db_path?t(null,n.options.db_path):d.dir(t)},Database.prototype.close=function(e){e()},e.exports=Database},function(e,t,n){var r=n(24);const{LevelUpOutOfRangeError:o,BlockOutOfRangeError:i}=n(14);function LevelUpArrayAdapter(e,t,n){this.db=r(t),this.db=this.db.sublevel(e),this.name=e,this.serializer=n||{encode:function(e,t){t(null,e)},decode:function(e,t){t(null,e)}}}LevelUpArrayAdapter.prototype.length=function(e){this.db.get("length",function(t,n){if(t)return t.notFound?e(null,0):e(t);e(null,n)})},LevelUpArrayAdapter.prototype._get=function(e,t){var n=this;this.db.get(e,function(e,r){if(e)return t(e);n.serializer.decode(r,t)})},LevelUpArrayAdapter.prototype._put=function(e,t,n){var r=this;this.serializer.encode(t,function(t,o){if(t)return n(t);r.db.put(e,o,n)})},LevelUpArrayAdapter.prototype.get=function(e,t){var n=this;this.length(function(r,a){if(r)return t(r);if(e>=a){let r="blocks"===n.name?new i(e,a):new o(n.name,e,a);return t(r)}n._get(e,t)})},LevelUpArrayAdapter.prototype.push=function(e,t){var n=this;this.length(function(r,o){if(r)return t(r);n._put(o+"",e,function(e){if(e)return t(e);n.db.put("length",o+1,t)})})},LevelUpArrayAdapter.prototype.pop=function(e){var t=this;this.length(function(n,r){if(n)return e(n);var o=r-1;t._get(o+"",function(n,r){if(n)return e(n);t.db.del(o+"",function(n){if(n)return e(n);t.db.put("length",o,function(t){if(t)return e(t);e(null,r)})})})})},LevelUpArrayAdapter.prototype.last=function(e){var t=this;this.length(function(n,r){return n?e(n):0===r?e(null,null):void t._get(r-1+"",e)})},LevelUpArrayAdapter.prototype.first=function(e){this._get("0",e)},e.exports=LevelUpArrayAdapter},function(e,t,n){var r=n(24),o=n(2);function LevelUpObjectAdapter(e,t,n,o,i){this.db=r(t,i),this.db=this.db.sublevel(e),this.name=e,this.valueserializer=n||{encode:function(e,t){t(null,e)},decode:function(e,t){t(null,e)}},this.keyserializer=o||{encode:function(e,t){t(null,e)},decode:function(e,t){t(null,e)}}}LevelUpObjectAdapter.prototype.get=function(e,t,n){var r=this;"function"==typeof t&&(n=t,t={}),this.keyserializer.encode(e,function(e,t){if(e)return n(e);r.db.get(t,function(e,t){if(e)return n(e);r.valueserializer.decode(t,function(e,t){if(e)return n(e);n(null,t)})})})},LevelUpObjectAdapter.prototype.put=function(e,t,n,r){var o=this;"function"==typeof n&&(r=n,n={}),this.keyserializer.encode(e,function(e,n){if(e)return r(e);o.valueserializer.encode(t,function(e,t){if(e)return r(e);o.db.put(n,t,r)})})},LevelUpObjectAdapter.prototype.set=LevelUpObjectAdapter.prototype.put,LevelUpObjectAdapter.prototype.del=function(e,t){var n=this;this.keyserializer.encode(e,function(e,r){if(e)return t(e);n.db.del(r,t)})},LevelUpObjectAdapter.prototype.batch=function(e,t,n){var r=this;o.each(e,function(e,n){"put"===e.type?r.put(e.key,e.value,t,n):"del"===e.type?r.del(e.key,n):n(new Error("Unknown batch type",e.type))},function(e){if(e)return n(e);n()})},LevelUpObjectAdapter.prototype.isOpen=function(){return!0},e.exports=LevelUpObjectAdapter},function(e,t){e.exports=require("levelup")},function(e,t){e.exports=require("encoding-down")},function(e,t,n){var r=n(1),o=n(62).AbstractLevelDOWN,i=n(2),a=n(25),s=n(63);function FileDown(e){this.location=e,o.call(this,e)}r.inherits(FileDown,o),FileDown.prototype._open=function(e,t){t(null,this)},FileDown.prototype._put=function(e,t,n,r){a.writeFile(s.join(this.location,e),t,"utf8",r)},FileDown.prototype._get=function(e,t,n){a.readFile(s.join(this.location,e),"utf8",function(e,t){if(e)return n(new Error("NotFound"));n(null,t)})},FileDown.prototype._del=function(e,t,n){a.unlink(s.join(this.location,e),function(e){if(e)return e.message.indexOf("ENOENT")>=0?n():n(e);n()})},FileDown.prototype._batch=function(e,t,n){var r=this;i.each(e,function(e,n){"put"===e.type?r.put(e.key,e.value,t,n):"del"===e.type?r.del(e.key,t,n):n(new Error("Unknown batch type",e.type))},function(e){if(e)return n(e);n()})},e.exports=function(e){return new FileDown(e)}},function(e,t){e.exports=require("abstract-leveldown")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("cachedown")},function(e,t,n){var r=n(26),o=n(2),i=n(11);e.exports={encode:function(e,t){var n=e.toJSON(!0);o.map(e.transactions,function(e,t){r.encode(e,t)},function(e,r){if(e)return t(e);n.transactions=r,t(null,n)})},decode:function(e,t){var n=e.transactions;e.transactions=[];var a=new i(e);o.eachSeries(n,function(e,t){r.decode(e,function(e,n){if(e)return t(e);a.transactions.push(n),t()})},function(e){if(e)return t(e);t(null,a)})}}},function(e,t,n){var r=n(3),o=n(0);e.exports={encode:function(e,t){t(null,o.hex(e))},decode:function(e,t){t(null,r.toBuffer(e))}}},function(e,t,n){var r=n(12),o=n(2);function BlockLogsSerializer(e){this.database=e}BlockLogsSerializer.prototype.encode=function(e,t){t(null,e=e.map(function(e){return e.toJSON()}))},BlockLogsSerializer.prototype.decode=function(e,t){var n=this;if(0===e.length)return t(null,[]);this.database.blockHashes.get(e[0].blockHash,function(i,a){if(i)return t(i);n.database.blocks.get(a,function(n,i){if(n)return t(n);o.map(e,function(e,t){t(null,new r({block:i,logIndex:e.logIndex,transactionIndex:e.transactionIndex,transactionHash:e.transactionHash,address:e.address,data:e.data,topics:e.topics,type:e.type}))},function(e,n){if(e)return t(e);t(null,n)})})})},e.exports=BlockLogsSerializer},function(e,t,n){var r=n(13),o=n(2);function ReceiptSerializer(e){this.database=e}ReceiptSerializer.prototype.encode=function(e,t){t(null,e.toJSON())},ReceiptSerializer.prototype.decode=function(e,t){var n=this,i=e.transactionHash.toLowerCase();this.database.transactions.get(e.transactionHash,function(a,s){if(a)return t(a);n.database.blockHashes.get(e.blockHash,function(a,c){if(a)return t(a);o.parallel({block:n.database.blocks.get.bind(n.database.blocks,c),logs:n.database.blockLogs.get.bind(n.database.blockLogs,c)},function(n,o){if(n)return t(n);t(null,new r(s,o.block,o.logs.filter(e=>e.transactionHash.toLowerCase()===i),e.gasUsed,e.cumulativeGasUsed,e.contractAddress,e.status,e.logsBloom))})})})},e.exports=ReceiptSerializer},function(e,t){e.exports=require("tmp")},function(e,t){e.exports=(e,t,n)=>{const s=a();e.on("step",s.collect),e.runTx(t,function(e,t){if(e)return n(e);if(0===t.vm.exception){const e=t.vm.exceptionError?new Error(`execution error: ${t.vm.exceptionError.error}`):new Error("execution error");return e.code=-32e3,n(e)}if(s.done()){let e=t.gasUsed;t.gasEstimate=e}else{const e=s.ops[0].gasLeft.sub(s.ops[s.ops.length-1].gasLeft).toNumber(),n=u()-e;t.gasEstimate=t.gasUsed.addn(n)}n(e,t)});const c=(e,t)=>{const n=0===e;let r=e,o=0,i=0,a=0;const c=s.ops[e],u=s.ops[e+1],l=c.gasLeft-u.gasLeft;let h=t||0,p=!1;function addGas(e){a&&(e>=a?a=0:a-=e),i+=e}return{start:()=>r,stop:()=>o,setStart:e=>{r=e,p=!0},setStop:e=>{o=e},getCost:()=>({cost:i,sixtyFloorths:a}),transfer:e=>{const t=e.getCost();addGas(t.cost),a+=t.sixtyFloorths},addSixtyFloorth:e=>{a+=e},addRange:(e=0)=>{addGas(s.ops[n||p?r:r+1].gasLeft-s.ops[o].gasLeft+e)},finalizeRange:()=>{let e;if(p&&o!==s.ops.length-1){addGas(e=s.ops[r].gasLeft-s.ops[o-1].gasLeft),e=s.ops[o-1].gasLeft-s.ops[o].gasLeft+l}else e=s.ops[r].gasLeft-s.ops[o].gasLeft;addGas(e-=h),o!==s.ops.length-1&&(i+=a,a=Math.floor(i/63))}}},u=()=>{const e=s.systemOps,t=s.ops,n=t=>e[t].index,a=[];let u=0,l=c(0);for(;u<e.length;){const e=n(u),h=t[e],p=h.opcode.name;if(r(p)||o(p))s.isSVT(e)?(l.setStop(e+1),l.addRange(),l.setStart(e+1),l.addSixtyFloorth(2300)):(l.setStop(e),l.addRange(h.opcode.fee),a.push(l),l=c(e,h.opcode.fee));else{if(!i(p))throw new Error("INVALID OPCODE");{l.setStop(e+1<s.ops.length?e+1:e),l.finalizeRange();const t=a.pop();if(!t)break;t.transfer(l),(l=t).setStart(e+1)}}u++}let h=l.getCost();return h.cost+h.sixtyFloorths}};const n=e=>t=>e.includes(t),r=n(["CALL","DELEGATECALL","STATICCALL","CALLCODE"]),o=n(["CREATE","CREATE2"]),i=n(["STOP","RETURN","REVERT","INVALID","SELFDESTRUCT"]),a=()=>{const e=[],t=[],n=[];let a=!1,s=0;return{collect:c=>{a&&(c.depth===s&&n.push(t.length-1),a=!1),r(c.opcode.name)?(a=!0,s=c.depth,e.push({index:t.length,depth:c.depth,name:c.opcode.name})):(o(c.opcode.name)||i(c.opcode.name))&&e.push({index:t.length,depth:c.depth,name:c.opcode.name}),t.push(c)},isSVT:e=>n.includes(e),done:()=>!t.length||e.length<2||!i(t[t.length-1].opcode.name),ops:t,systemOps:e}}},function(e,t,n){var r=n(22),o=n(7).default,i=n(11),a=n(12),s=n(13),c=n(3),u=n(72),l=n(16),h=n(0),p=n(9),f=n(2);const d=c.BN;function ForkedBlockchain(e){if(this.options=e||{},null==e.fork)throw new Error("ForkedBlockchain must be passed a fork parameter.");if(this.fork=e.fork,this.forkBlockNumber=e.fork_block_number,this.forkVersion=null,"string"==typeof this.fork){if(this.fork.indexOf("@")>=0){var t=this.fork.split("@");this.fork=t[0],this.forkBlockNumber=parseInt(t[1])}this.fork=new l.providers.HttpProvider(this.fork)}this.time=e.time,this.storageTrieCache={},r.call(this,e),this.createVMFromStateTrie=function(){var e=r.prototype.createVMFromStateTrie.apply(this,arguments);return this.patchVM(e),e},this.web3=new l(this.fork)}(0,n(1).inherits)(ForkedBlockchain,r),ForkedBlockchain.prototype.initialize=function(e,t){var n=this;this.web3.eth.net.getId(function(o,i){if(o)return t(o);n.forkVersion=i,r.prototype.initialize.call(n,e,t)})},ForkedBlockchain.prototype.patchVM=function(e){const t=e.stateManager._trie,n=this.getLookupAccount(t);e.stateManager._cache._lookupAccount=n,e.stateManager._lookupStorageTrie=this.getLookupStorageTrie(t,n),e.stateManager.getContractCode=this.getCode.bind(this)},ForkedBlockchain.prototype.createStateTrie=function(e,t,n){return(n=Object.assign({fork:this.fork,forkBlockNumber:this.forkBlockNumber,blockchain:this},n)).forkBlockNumber>this.forkBlockNumber&&(n.forkBlockNumber=this.forkBlockNumber),new u(e,t,n)},ForkedBlockchain.prototype.createGenesisBlock=function(e){var t=this,n=this.forkBlockNumber||"latest";t.web3.eth.getBlock(n,function(r,o){if(r)return e(r);!t.time&&t.forkBlockNumber&&(t.time=t.options.time=new Date(1e3*h.number(o.timestamp)),t.setTime(t.time)),n=o.number,t.forkBlockNumber=t.options.fork_block_number=n,t.stateTrie.forkBlockNumber=t.stateTrie.options.forkBlockNumber=n,t.createBlock(function(t,n){if(t)return e(t);n.header.number=c.toBuffer(h.number(o.number)+1),n.header.parentHash=c.toBuffer(o.hash),e(null,n)})})},ForkedBlockchain.prototype.getLookupStorageTrie=function(e,t){return t=t||this.getLookupAccount(e),(n,r)=>{const o=e.copy();o.address=n,t(n,(e,t)=>{if(e)return r(e);o.root=t.stateRoot,r(null,o)})}},ForkedBlockchain.prototype.isFallbackBlock=function(e,t){var n=this;n.getEffectiveBlockNumber(e,function(e,r){if(e)return t(e);t(null,r<=h.number(n.forkBlockNumber))})},ForkedBlockchain.prototype.isBlockHash=function(e){return"string"==typeof e&&0===e.indexOf("0x")&&e.length>42||Buffer.isBuffer(e)&&e.byteLength>20},ForkedBlockchain.prototype.isFallbackBlockHash=function(e,t){if(!this.isBlockHash(e))return t(null,!1);Buffer.isBuffer(e)&&(e=h.hex(e)),this.data.blockHashes.get(e,function(e,n){if(e)return e.notFound?t(null,!0):t(e);t(null,!1)})},ForkedBlockchain.prototype.getFallbackBlock=function(e,t){Buffer.isBuffer(e)&&(e=h.rpcDataHexString(e)),this.web3.eth.getBlock(e,!0,function(e,n){if(e)return t(e);if(null==n)return t();var r=new i;r.header.parentHash=c.toBuffer(n.parentHash),r.header.uncleHash=c.toBuffer(n.sha3Uncles),r.header.coinbase=c.toBuffer(n.miner),r.header.stateRoot=c.toBuffer(n.stateRoot),r.header.transactionsTrie=c.toBuffer(n.transactionsRoot),r.header.receiptTrie=c.toBuffer(n.receiptsRoot),r.header.bloom=c.toBuffer(n.logsBloom),r.header.difficulty=c.toBuffer("0x"+n.totalDifficulty.toString(16)),r.header.number=c.toBuffer(n.number),r.header.gasLimit=c.toBuffer(n.gasLimit),r.header.gasUsed=c.toBuffer(n.gasUsed),r.header.timestamp=c.toBuffer(n.timestamp),r.header.extraData=c.toBuffer(n.extraData),(n.transactions||[]).forEach(function(e,t){r.transactions.push(p.fromJSON(e,p.types.real))}),r.hash=function(){return c.toBuffer(n.hash)},t(null,r)})},ForkedBlockchain.prototype.getBlock=function(e,t){let n;const o=this.isBlockHash(e);(n=o?this.isFallbackBlockHash:this.isFallbackBlock).call(this,e,(n,i)=>{if(n)return t(n);if(i)return this.getFallbackBlock(e,t);const a=r.prototype.getBlock.bind(this);o?a(e,t):this.getRelativeBlockNumber(e,(e,n)=>{if(e)return t(e);a(n,t)})})},ForkedBlockchain.prototype.getStorage=function(e,t,n,r){this.getLookupStorageTrie(this.stateTrie)(e,(e,o)=>{if(e)return r(e);this.getEffectiveBlockNumber(n,(e,n)=>{if(e)return r(e);o.get(c.setLengthLeft(c.toBuffer(t),32),n,r)})})},ForkedBlockchain.prototype.getCode=function(e,t,n){var o=this;"function"==typeof t&&(n=t,t="latest"),t||(t="latest"),this.getEffectiveBlockNumber(t,function(i,a){if(i)return n(i);t=a,o.stateTrie.keyExists(e,function(i,a){if(i)return n(i);a&&t>h.number(o.forkBlockNumber)?r.prototype.getCode.call(o,e,t,n):(t>h.number(o.forkBlockNumber)&&(t="latest"),o.fetchCodeFromFallback(e,t,function(e,t){t&&(t=c.toBuffer(t)),n(e,t)}))})})},ForkedBlockchain.prototype.getLookupAccount=function(e){return(t,n)=>{e.keyExists(t,(r,i)=>{if(r)return n(r);i?e.get(t,(e,t)=>{if(e)return n(e);const r=new o(t);n(null,r)}):this.fetchAccountFromFallback(t,h.number(e.forkBlockNumber),n)})}},ForkedBlockchain.prototype.getAccount=function(e,t,n){var o=this;"function"==typeof t&&(n=t,t="latest"),this.getEffectiveBlockNumber(t,function(i,a){if(i)return n(i);t=a,o.stateTrie.keyExists(e,function(i,a){if(i)return n(i);a&&t>h.number(o.forkBlockNumber)?r.prototype.getAccount.call(o,e,t,function(e,t){if(e)return n(e);n(null,t)}):o.fetchAccountFromFallback(e,t,n)})})},ForkedBlockchain.prototype.getTransaction=function(e,t){var n=this;r.prototype.getTransaction.call(this,e,function(r,o){return r?t(r):null!=o?t(null,o):void n.web3.eth.getTransaction(e,function(e,n){if(e)return t(e);n&&(n=p.fromJSON(n,p.types.signed)),t(null,n)})})},ForkedBlockchain.prototype.getTransactionReceipt=function(e,t){var n=this;r.prototype.getTransactionReceipt.call(this,e,function(r,o){return r?t(r):o?t(null,o):void n.web3.eth.getTransactionReceipt(e,function(r,o){return r?t(r):o?void f.parallel({tx:n.getTransaction.bind(n,e),block:n.getBlock.bind(n,o.blockNumber)},function(e,n){if(e)return t(e);var r=o.logs.map(function(e){return new a(e)}),i=new s(n.tx,n.block,r,o.gasUsed,o.cumulativeGasUsed,o.contractAddress,o.status,h.hex(o.logsBloom));t(null,i)}):t()})})},ForkedBlockchain.prototype.fetchAccountFromFallback=function(e,t,n){var r=this;e=h.hex(e),f.parallel({code:this.fetchCodeFromFallback.bind(this,e,t),balance:this.fetchBalanceFromFallback.bind(this,e,t),nonce:this.fetchNonceFromFallback.bind(this,e,t)},function(e,t){if(e)return n(e);var i=t.code,a=t.balance,s=t.nonce,u=new o({nonce:s,balance:a});u.setCode(r.stateTrie,c.toBuffer(i),function(e){if(e)return n(e);n(null,u)})})},ForkedBlockchain.prototype.fetchCodeFromFallback=function(e,t,n){var r=this;e=h.hex(e),"function"==typeof t&&(n=t,t=this.forkBlockNumber),this.getSafeFallbackBlockNumber(t,function(t,o){if(t)return n(t);r.web3.eth.getCode(e,o,function(e,t){if(e)return n(e);t="0x"+c.toBuffer(t).toString("hex"),n(null,t)})})},ForkedBlockchain.prototype.fetchBalanceFromFallback=function(e,t,n){var r=this;e=h.hex(e),"function"==typeof t&&(n=t,t=this.forkBlockNumber),this.getSafeFallbackBlockNumber(t,function(t,o){if(t)return n(t);r.web3.eth.getBalance(e,o,function(e,t){if(e)return n(e);t="0x"+new d(t).toString(16),n(null,t)})})},ForkedBlockchain.prototype.fetchNonceFromFallback=function(e,t,n){var r=this;e=h.hex(e),"function"==typeof t&&(n=t,t=this.forkBlockNumber),this.getSafeFallbackBlockNumber(t,function(t,o){if(t)return n(t);r.web3.eth.getTransactionCount(e,o,function(e,t){if(e)return n(e);t="0x"+r.web3.utils.toBN(t).toString(16),n(null,t)})})},ForkedBlockchain.prototype.getHeight=function(e){this.latestBlock(function(t,n){if(t)return e(t);e(null,h.number(n.header.number))})},ForkedBlockchain.prototype.getRelativeBlockNumber=function(e,t){var n=this;this.getEffectiveBlockNumber(e,function(e,r){if(e)return t(e);t(null,r-h.number(n.forkBlockNumber)-1)})},ForkedBlockchain.prototype.getSafeFallbackBlockNumber=function(e,t){var n=h.number(this.forkBlockNumber);if(null==e)return t(null,n);this.getEffectiveBlockNumber(e,function(e,r){if(e)return t(e);r>n&&(r=n),t(null,r)})},ForkedBlockchain.prototype.getBlockLogs=function(e,t){var n=this;this.getEffectiveBlockNumber(e,function(o,i){if(o)return t(o);n.getRelativeBlockNumber(i,function(o,i){if(o)return t(o);i<0?n.getBlock(e,function(r,o){if(r)return t(r);n.web3.currentProvider.send({jsonrpc:"2.0",method:"eth_getLogs",params:[{fromBlock:h.hex(e),toBlock:h.hex(e)}],id:(new Date).getTime()},function(e,n){if(e)return t(e);var r=n.result.map(function(e){return e.block=o,new a(e)});t(null,r)})}):r.prototype.getBlockLogs.call(n,i,t)})})},e.exports=ForkedBlockchain},function(e,t,n){const r=n(23),o=n(73),i=n(74);var a=n(3),s=n(1).inherits,c=n(16),u=n(0);function ForkedStorageBaseTrie(e,t,n){o.call(this,e,t),this.options=n,this.address=n.address,this.forkBlockNumber=n.forkBlockNumber,this.blockchain=n.blockchain,this.fork=n.fork,this.web3=new c(this.fork)}function ForkedStorageTrie(e,t,n){ForkedStorageBaseTrie.call(this,e,t,n),i(this)}s(ForkedStorageBaseTrie,o),ForkedStorageBaseTrie.prototype.get=function(e,t,n){var o=this;"function"==typeof t&&(n=t,t=this.forkBlockNumber),e=a.toBuffer(e),this.keyExists(e,function(i,s){if(i)return n(i);s?r.prototype.get.call(o,e,function(e,t){n(e,t)}):null==o.address?o.blockchain.fetchAccountFromFallback(e,t,function(e,t){if(e)return n(e);n(null,t.serialize())}):(u.number(t)>u.number(o.forkBlockNumber)&&(t=o.forkBlockNumber),o.web3.eth.getStorageAt(u.rpcDataHexString(o.address),u.rpcDataHexString(e),t,function(e,t){if(e)return n(e);t=a.rlp.encode(t),n(null,t)}))})},ForkedStorageBaseTrie.prototype.keyExists=function(e,t){e=a.toBuffer(e),this.findPath(e,function(e,n,r,o){const i=n&&0===r.length;t(e,i)})},ForkedStorageBaseTrie.prototype.copy=function(){return new ForkedStorageBaseTrie(this.db,this.root,this.options)},s(ForkedStorageTrie,ForkedStorageBaseTrie),ForkedStorageTrie.prove=r.prove,ForkedStorageTrie.verifyProof=r.verifyProof,e.exports=ForkedStorageTrie},function(e,t){e.exports=require("merkle-patricia-tree/baseTrie")},function(e,t){e.exports=require("merkle-patricia-tree/checkpoint-interface")},function(e){e.exports={name:"web3",version:"1.2.1",description:"Ethereum JavaScript API",repository:"https://github.com/ethereum/web3.js/tree/1.x/packages/web3",license:"LGPL-3.0",engines:{node:">=8.0.0"},main:"src/index.js",bugs:{url:"https://github.com/ethereum/web3.js/issues"},keywords:["Ethereum","JavaScript","API"],author:"ethereum.org",authors:[{name:"Fabian Vogelsteller",email:"fabian@ethereum.org",homepage:"http://frozeman.de"},{name:"Marek Kotewicz",email:"marek@parity.io",url:"https://github.com/debris"},{name:"Marian Oancea",url:"https://github.com/cubedro"},{name:"Gav Wood",email:"g@parity.io",homepage:"http://gavwood.com"},{name:"Jeffery Wilcke",email:"jeffrey.wilcke@ethereum.org",url:"https://github.com/obscuren"}],dependencies:{"web3-bzz":"1.2.1","web3-core":"1.2.1","web3-eth":"1.2.1","web3-eth-personal":"1.2.1","web3-net":"1.2.1","web3-shh":"1.2.1","web3-utils":"1.2.1"},_resolved:"https://registry.npmjs.org/web3/-/web3-1.2.1.tgz",_integrity:"sha512-nNMzeCK0agb5i/oTWNdQ1aGtwYfXzHottFP2Dz0oGIzavPMGSKyVlr8ibVb1yK5sJBjrWVnTdGaOC2zKDFuFRw==",_from:"web3@1.2.1"}},function(e,t,n){"use strict";var r=n(18),o=n(17),i=n(27),a=n(77).subscriptions,s=n(28),c=n(19),u=n(29),l=n(78),h=n(30),p=n(79),f=n(80),d=n(81),g=n(94),m=n(95),b=i.formatters,y=function(e){return r.isString(e[0])&&0===e[0].indexOf("0x")?"eth_getBlockByHash":"eth_getBlockByNumber"},k=function(e){return r.isString(e[0])&&0===e[0].indexOf("0x")?"eth_getTransactionByBlockHashAndIndex":"eth_getTransactionByBlockNumberAndIndex"},v=function(e){return r.isString(e[0])&&0===e[0].indexOf("0x")?"eth_getUncleByBlockHashAndIndex":"eth_getUncleByBlockNumberAndIndex"},x=function(e){return r.isString(e[0])&&0===e[0].indexOf("0x")?"eth_getBlockTransactionCountByHash":"eth_getBlockTransactionCountByNumber"},_=function(e){return r.isString(e[0])&&0===e[0].indexOf("0x")?"eth_getUncleCountByBlockHash":"eth_getUncleCountByBlockNumber"},w=function(){var e=this;o.packageInit(this,arguments);var t=this.setProvider;this.setProvider=function(){t.apply(e,arguments),e.net.setProvider.apply(e,arguments),e.personal.setProvider.apply(e,arguments),e.accounts.setProvider.apply(e,arguments),e.Contract.setProvider(e.currentProvider,e.accounts)};var n=null,i="latest";Object.defineProperty(this,"defaultAccount",{get:function(){return n},set:function(t){return t&&(n=c.toChecksumAddress(b.inputAddressFormatter(t))),e.Contract.defaultAccount=n,e.personal.defaultAccount=n,S.forEach(function(e){e.defaultAccount=n}),t},enumerable:!0}),Object.defineProperty(this,"defaultBlock",{get:function(){return i},set:function(t){return i=t,e.Contract.defaultBlock=i,e.personal.defaultBlock=i,S.forEach(function(e){e.defaultBlock=i}),t},enumerable:!0}),this.clearSubscriptions=e._requestManager.clearSubscriptions,this.net=new u(this.currentProvider),this.net.getNetworkType=m.bind(this),this.accounts=new d(this.currentProvider),this.personal=new h(this.currentProvider),this.personal.defaultAccount=this.defaultAccount;var w=this,B=function(){p.apply(this,arguments);var e=this,t=w.setProvider;w.setProvider=function(){t.apply(w,arguments),o.packageInit(e,[w.currentProvider])}};B.setProvider=function(){p.setProvider.apply(this,arguments)},B.prototype=Object.create(p.prototype),B.prototype.constructor=B,this.Contract=B,this.Contract.defaultAccount=this.defaultAccount,this.Contract.defaultBlock=this.defaultBlock,this.Contract.setProvider(this.currentProvider,this.accounts),this.Iban=f,this.abi=g,this.ens=new l(this);var S=[new s({name:"getNodeInfo",call:"web3_clientVersion"}),new s({name:"getProtocolVersion",call:"eth_protocolVersion",params:0}),new s({name:"getCoinbase",call:"eth_coinbase",params:0}),new s({name:"isMining",call:"eth_mining",params:0}),new s({name:"getHashrate",call:"eth_hashrate",params:0,outputFormatter:c.hexToNumber}),new s({name:"isSyncing",call:"eth_syncing",params:0,outputFormatter:b.outputSyncingFormatter}),new s({name:"getGasPrice",call:"eth_gasPrice",params:0,outputFormatter:b.outputBigNumberFormatter}),new s({name:"getAccounts",call:"eth_accounts",params:0,outputFormatter:c.toChecksumAddress}),new s({name:"getBlockNumber",call:"eth_blockNumber",params:0,outputFormatter:c.hexToNumber}),new s({name:"getBalance",call:"eth_getBalance",params:2,inputFormatter:[b.inputAddressFormatter,b.inputDefaultBlockNumberFormatter],outputFormatter:b.outputBigNumberFormatter}),new s({name:"getStorageAt",call:"eth_getStorageAt",params:3,inputFormatter:[b.inputAddressFormatter,c.numberToHex,b.inputDefaultBlockNumberFormatter]}),new s({name:"getCode",call:"eth_getCode",params:2,inputFormatter:[b.inputAddressFormatter,b.inputDefaultBlockNumberFormatter]}),new s({name:"getBlock",call:y,params:2,inputFormatter:[b.inputBlockNumberFormatter,function(e){return!!e}],outputFormatter:b.outputBlockFormatter}),new s({name:"getUncle",call:v,params:2,inputFormatter:[b.inputBlockNumberFormatter,c.numberToHex],outputFormatter:b.outputBlockFormatter}),new s({name:"getBlockTransactionCount",call:x,params:1,inputFormatter:[b.inputBlockNumberFormatter],outputFormatter:c.hexToNumber}),new s({name:"getBlockUncleCount",call:_,params:1,inputFormatter:[b.inputBlockNumberFormatter],outputFormatter:c.hexToNumber}),new s({name:"getTransaction",call:"eth_getTransactionByHash",params:1,inputFormatter:[null],outputFormatter:b.outputTransactionFormatter}),new s({name:"getTransactionFromBlock",call:k,params:2,inputFormatter:[b.inputBlockNumberFormatter,c.numberToHex],outputFormatter:b.outputTransactionFormatter}),new s({name:"getTransactionReceipt",call:"eth_getTransactionReceipt",params:1,inputFormatter:[null],outputFormatter:b.outputTransactionReceiptFormatter}),new s({name:"getTransactionCount",call:"eth_getTransactionCount",params:2,inputFormatter:[b.inputAddressFormatter,b.inputDefaultBlockNumberFormatter],outputFormatter:c.hexToNumber}),new s({name:"sendSignedTransaction",call:"eth_sendRawTransaction",params:1,inputFormatter:[null]}),new s({name:"signTransaction",call:"eth_signTransaction",params:1,inputFormatter:[b.inputTransactionFormatter]}),new s({name:"sendTransaction",call:"eth_sendTransaction",params:1,inputFormatter:[b.inputTransactionFormatter]}),new s({name:"sign",call:"eth_sign",params:2,inputFormatter:[b.inputSignFormatter,b.inputAddressFormatter],transformPayload:function(e){return e.params.reverse(),e}}),new s({name:"call",call:"eth_call",params:2,inputFormatter:[b.inputCallFormatter,b.inputDefaultBlockNumberFormatter]}),new s({name:"estimateGas",call:"eth_estimateGas",params:1,inputFormatter:[b.inputCallFormatter],outputFormatter:c.hexToNumber}),new s({name:"submitWork",call:"eth_submitWork",params:3}),new s({name:"getWork",call:"eth_getWork",params:0}),new s({name:"getPastLogs",call:"eth_getLogs",params:1,inputFormatter:[b.inputLogFormatter],outputFormatter:b.outputLogFormatter}),new a({name:"subscribe",type:"eth",subscriptions:{newBlockHeaders:{subscriptionName:"newHeads",params:0,outputFormatter:b.outputBlockFormatter},pendingTransactions:{subscriptionName:"newPendingTransactions",params:0},logs:{params:1,inputFormatter:[b.inputLogFormatter],outputFormatter:b.outputLogFormatter,subscriptionHandler:function(e){e.removed?this.emit("changed",e):this.emit("data",e),r.isFunction(this.callback)&&this.callback(null,e,this)}},syncing:{params:0,outputFormatter:b.outputSyncingFormatter,subscriptionHandler:function(e){var t=this;!0!==this._isSyncing?(this._isSyncing=!0,this.emit("changed",t._isSyncing),r.isFunction(this.callback)&&this.callback(null,t._isSyncing,this),setTimeout(function(){t.emit("data",e),r.isFunction(t.callback)&&t.callback(null,e,t)},0)):(this.emit("data",e),r.isFunction(t.callback)&&this.callback(null,e,this),clearTimeout(this._isSyncingTimeout),this._isSyncingTimeout=setTimeout(function(){e.currentBlock>e.highestBlock-200&&(t._isSyncing=!1,t.emit("changed",t._isSyncing),r.isFunction(t.callback)&&t.callback(null,t._isSyncing,t))},500))}}}})];S.forEach(function(t){t.attachToObject(e),t.setRequestManager(e._requestManager,e.accounts),t.defaultBlock=e.defaultBlock,t.defaultAccount=e.defaultAccount})};o.addProviders(w),e.exports=w},function(e,t){e.exports=require("web3-core-subscriptions")},function(e,t){e.exports=require("web3-eth-ens")},function(e,t){e.exports=require("web3-eth-contract")},function(e,t){e.exports=require("web3-eth-iban")},function(e,t,n){"use strict";var r=n(18),o=n(17),i=n(28),a=n(82),s=n(83),c=n(84),u=n(85),l=n(86),h=n(87),p="undefined"==typeof global?n(88):n(10),f=n(89),d=n(93),g=n(19),m=n(27),b=function(e){return r.isUndefined(e)||r.isNull(e)},y=function(e){for(;e&&e.startsWith("0x0");)e="0x"+e.slice(3);return e},k=function(e){return e.length%2==1&&(e=e.replace("0x","0x0")),e},v=function(){var e=this;o.packageInit(this,arguments),delete this.BatchRequest,delete this.extend;var t=[new i({name:"getId",call:"net_version",params:0,outputFormatter:g.hexToNumber}),new i({name:"getGasPrice",call:"eth_gasPrice",params:0}),new i({name:"getTransactionCount",call:"eth_getTransactionCount",params:2,inputFormatter:[function(e){if(g.isAddress(e))return e;throw new Error("Address "+e+' is not a valid address to get the "transactionCount".')},function(){return"latest"}]})];this._ethereumCall={},r.each(t,function(t){t.attachToObject(e._ethereumCall),t.setRequestManager(e._requestManager)}),this.wallet=new Wallet(this)};function Wallet(e){this._accounts=e,this.length=0,this.defaultKeyName="web3js_wallet"}v.prototype._addAccountFunctions=function(e){var t=this;return e.signTransaction=function(n,r){return t.signTransaction(n,e.privateKey,r)},e.sign=function(n){return t.sign(n,e.privateKey)},e.encrypt=function(n,r){return t.encrypt(e.privateKey,n,r)},e},v.prototype.create=function(e){return this._addAccountFunctions(s.create(e||g.randomHex(32)))},v.prototype.privateKeyToAccount=function(e){return this._addAccountFunctions(s.fromPrivate(e))},v.prototype.signTransaction=function(e,t,n){var o,i=!1;if(n=n||function(){},!e)return i=new Error("No transaction object given!"),n(i),a.reject(i);function signed(e){if(e.gas||e.gasLimit||(i=new Error('"gas" is missing')),(e.nonce<0||e.gas<0||e.gasPrice<0||e.chainId<0)&&(i=new Error("Gas, gasPrice, nonce or chainId is lower than 0")),i)return n(i),a.reject(i);try{var r=e=m.formatters.inputCallFormatter(e);r.to=e.to||"0x",r.data=e.data||"0x",r.value=e.value||"0x",r.chainId=g.numberToHex(e.chainId);var p=u.encode([h.fromNat(r.nonce),h.fromNat(r.gasPrice),h.fromNat(r.gas),r.to.toLowerCase(),h.fromNat(r.value),r.data,h.fromNat(r.chainId||"0x1"),"0x","0x"]),f=c.keccak256(p),d=s.makeSigner(2*l.toNumber(r.chainId||"0x1")+35)(c.keccak256(p),t),b=u.decode(p).slice(0,6).concat(s.decodeSignature(d));b[6]=k(y(b[6])),b[7]=k(y(b[7])),b[8]=k(y(b[8]));var v=u.encode(b),x=u.decode(v);o={messageHash:f,v:y(x[6]),r:y(x[7]),s:y(x[8]),rawTransaction:v}}catch(e){return n(e),a.reject(e)}return n(null,o),o}return void 0!==e.nonce&&void 0!==e.chainId&&void 0!==e.gasPrice?a.resolve(signed(e)):a.all([b(e.chainId)?this._ethereumCall.getId():e.chainId,b(e.gasPrice)?this._ethereumCall.getGasPrice():e.gasPrice,b(e.nonce)?this._ethereumCall.getTransactionCount(this.privateKeyToAccount(t).address):e.nonce]).then(function(t){if(b(t[0])||b(t[1])||b(t[2]))throw new Error('One of the values "chainId", "gasPrice", or "nonce" couldn\'t be fetched: '+JSON.stringify(t));return signed(r.extend(e,{chainId:t[0],gasPrice:t[1],nonce:t[2]}))})},v.prototype.recoverTransaction=function(e){var t=u.decode(e),n=s.encodeSignature(t.slice(6,9)),r=h.toNumber(t[6]),o=r<35?[]:[h.fromNumber(r-35>>1),"0x","0x"],i=t.slice(0,6).concat(o),a=u.encode(i);return s.recover(c.keccak256(a),n)},v.prototype.hashMessage=function(e){var t=g.isHexStrict(e)?g.hexToBytes(e):e,n=Buffer.from(t),r="Ethereum Signed Message:\n"+t.length,o=Buffer.from(r),i=Buffer.concat([o,n]);return c.keccak256s(i)},v.prototype.sign=function(e,t){var n=this.hashMessage(e),r=s.sign(n,t),o=s.decodeSignature(r);return{message:e,messageHash:n,v:o[0],r:o[1],s:o[2],signature:r}},v.prototype.recover=function(e,t,n){var o=[].slice.apply(arguments);return r.isObject(e)?this.recover(e.messageHash,s.encodeSignature([e.v,e.r,e.s]),!0):(n||(e=this.hashMessage(e)),o.length>=4?(n=o.slice(-1)[0],n=!!r.isBoolean(n)&&!!n,this.recover(e,s.encodeSignature(o.slice(1,4)),n)):s.recover(e,t))},v.prototype.decrypt=function(e,t,n){if(!r.isString(t))throw new Error("No password given.");var o,i,a=r.isObject(e)?e:JSON.parse(n?e.toLowerCase():e);if(3!==a.version)throw new Error("Not a valid V3 wallet");if("scrypt"===a.crypto.kdf)i=a.crypto.kdfparams,o=f(Buffer.from(t),Buffer.from(i.salt,"hex"),i.n,i.r,i.p,i.dklen);else{if("pbkdf2"!==a.crypto.kdf)throw new Error("Unsupported key derivation scheme");if("hmac-sha256"!==(i=a.crypto.kdfparams).prf)throw new Error("Unsupported parameters to PBKDF2");o=p.pbkdf2Sync(Buffer.from(t),Buffer.from(i.salt,"hex"),i.c,i.dklen,"sha256")}var s=Buffer.from(a.crypto.ciphertext,"hex");if(g.sha3(Buffer.concat([o.slice(16,32),s])).replace("0x","")!==a.crypto.mac)throw new Error("Key derivation failed - possibly wrong password");var c=p.createDecipheriv(a.crypto.cipher,o.slice(0,16),Buffer.from(a.crypto.cipherparams.iv,"hex")),u="0x"+Buffer.concat([c.update(s),c.final()]).toString("hex");return this.privateKeyToAccount(u)},v.prototype.encrypt=function(e,t,n){var r,o=this.privateKeyToAccount(e),i=(n=n||{}).salt||p.randomBytes(32),a=n.iv||p.randomBytes(16),s=n.kdf||"scrypt",c={dklen:n.dklen||32,salt:i.toString("hex")};if("pbkdf2"===s)c.c=n.c||262144,c.prf="hmac-sha256",r=p.pbkdf2Sync(Buffer.from(t),Buffer.from(c.salt,"hex"),c.c,c.dklen,"sha256");else{if("scrypt"!==s)throw new Error("Unsupported kdf");c.n=n.n||8192,c.r=n.r||8,c.p=n.p||1,r=f(Buffer.from(t),Buffer.from(c.salt,"hex"),c.n,c.r,c.p,c.dklen)}var u=p.createCipheriv(n.cipher||"aes-128-ctr",r.slice(0,16),a);if(!u)throw new Error("Unsupported cipher");var l=Buffer.concat([u.update(Buffer.from(o.privateKey.replace("0x",""),"hex")),u.final()]),h=g.sha3(Buffer.concat([r.slice(16,32),Buffer.from(l,"hex")])).replace("0x","");return{version:3,id:d.v4({random:n.uuid||p.randomBytes(16)}),address:o.address.toLowerCase().replace("0x",""),crypto:{ciphertext:l.toString("hex"),cipherparams:{iv:a.toString("hex")},cipher:n.cipher||"aes-128-ctr",kdf:s,kdfparams:c,mac:h.toString("hex")}}},Wallet.prototype._findSafeIndex=function(e){return e=e||0,r.has(this,e)?this._findSafeIndex(e+1):e},Wallet.prototype._currentIndexes=function(){return Object.keys(this).map(function(e){return parseInt(e)}).filter(function(e){return e<9e20})},Wallet.prototype.create=function(e,t){for(var n=0;n<e;++n)this.add(this._accounts.create(t).privateKey);return this},Wallet.prototype.add=function(e){return r.isString(e)&&(e=this._accounts.privateKeyToAccount(e)),this[e.address]?this[e.address]:((e=this._accounts.privateKeyToAccount(e.privateKey)).index=this._findSafeIndex(),this[e.index]=e,this[e.address]=e,this[e.address.toLowerCase()]=e,this.length++,e)},Wallet.prototype.remove=function(e){var t=this[e];return!(!t||!t.address)&&(this[t.address].privateKey=null,delete this[t.address],this[t.address.toLowerCase()].privateKey=null,delete this[t.address.toLowerCase()],this[t.index].privateKey=null,delete this[t.index],this.length--,!0)},Wallet.prototype.clear=function(){var e=this;return this._currentIndexes().forEach(function(t){e.remove(t)}),this},Wallet.prototype.encrypt=function(e,t){var n=this;return this._currentIndexes().map(function(r){return n[r].encrypt(e,t)})},Wallet.prototype.decrypt=function(e,t){var n=this;return e.forEach(function(e){var r=n._accounts.decrypt(e,t);if(!r)throw new Error("Couldn't decrypt accounts. Password wrong?");n.add(r)}),this},Wallet.prototype.save=function(e,t){return localStorage.setItem(t||this.defaultKeyName,JSON.stringify(this.encrypt(e))),!0},Wallet.prototype.load=function(e,t){var n=localStorage.getItem(t||this.defaultKeyName);if(n)try{n=JSON.parse(n)}catch(e){}return this.decrypt(n||[],e)},"undefined"==typeof localStorage&&(delete Wallet.prototype.save,delete Wallet.prototype.load),e.exports=v},function(e,t){e.exports=require("any-promise")},function(e,t){e.exports=require("eth-lib/lib/account")},function(e,t){e.exports=require("eth-lib/lib/hash")},function(e,t){e.exports=require("eth-lib/lib/rlp")},function(e,t){e.exports=require("eth-lib/lib/nat")},function(e,t){e.exports=require("eth-lib/lib/bytes")},function(e,t){e.exports=require("crypto-browserify")},function(e,t,n){var r,o=n(90),i="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);if(i){var a=n(91),s=i&&a.Range(">=10.5.0").test(process.version),c=function(){var e;return function(){if(void 0!==e)return e;try{e=n(92)("scrypt")}catch(t){if(/was compiled against a different/.test(t.message))throw t;e=null}return e}}(),u=function(e){return"can improve web3's peformance when running Node.js versions older than "+e+" by installing the (deprecated) scrypt package in your project"};if(s){var l=n(10),h=0;r=function(e,t,n,r,i,a){try{return l.scryptSync(e,t,a,{N:n,r:r,p:i})}catch(l){if(/scrypt:memory limit exceeded/.test(l.message)){var s=c();return s?s.hashSync(e,{N:n,r:r,p:i},a,t):(h+=1,console.warn("[33m%s[0m","Memory limit exceeded for Node's built-in crypto.scrypt, falling back to scryptsy (times: "+h+"), if this happens frequently you "+u("12.0.0")),o(e,t,n,r,i,a))}throw l}}}else{var p=c();p?r=function(e,t,n,r,o,i){return p.hashSync(e,{N:n,r:r,p:o},i,t)}:console.warn("[33m%s[0m","You "+u("10.5.0"))}}r=r||o,e.exports=r},function(e,t){e.exports=require("scryptsy")},function(e,t){e.exports=require("semver")},function(e,t){function webpackEmptyContext(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}webpackEmptyContext.keys=function(){return[]},webpackEmptyContext.resolve=webpackEmptyContext,e.exports=webpackEmptyContext,webpackEmptyContext.id=92},function(e,t){e.exports=require("uuid")},function(e,t){e.exports=require("web3-eth-abi")},function(e,t,n){"use strict";var r=n(18);e.exports=function(e){var t,n=this;return this.net.getId().then(function(e){return t=e,n.getBlock(0)}).then(function(n){var o="private";return"0xd4e56740f876aef8c010b86a40d5f56745a118d0906a34e69aec8c0db1cb8fa3"===n.hash&&1===t&&(o="main"),"0cd786a2425d16f152c658316c423e6ce1181e15c3295826d7c9904cba9ce303"===n.hash&&2===t&&(o="morden"),"0x41941023680923e0fe4d74a34bdac8141f2540e3ae90623718e47d66d1ca4a2d"===n.hash&&3===t&&(o="ropsten"),"0x6341fd3daf94b748c72ced5a5b26028f2474f5f00d824504e4fa37a75767e177"===n.hash&&4===t&&(o="rinkeby"),"0xa3c565fc15c7478862d50ccd6561e3c06b24cc509bf388941c25ea985ce32cb9"===n.hash&&42===t&&(o="kovan"),r.isFunction(e)&&e(null,o),o}).catch(function(t){if(!r.isFunction(e))throw t;e(t)})}},function(e,t){e.exports=require("web3-shh")},function(e,t){e.exports=require("web3-bzz")},function(e,t){e.exports=require("eth-sig-util")},function(e,t){e.exports={randomBytes:function(e,t){for(var n=[],r=0;r<e;r++)n.push(255*t());return Buffer.from(n)},randomAlphaNumericString:function(e,t){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let r="";for(var o=0;o<e;o++)r+=n.charAt(Math.floor((t||Math.random)()*n.length));return r}}},function(e){e.exports={name:"ganache-core",version:"2.8.0",main:"./index.js",types:"./typings/index.d.ts",engines:{node:">=8.9.0"},directories:{lib:"./lib"},scripts:{_mocha:"mocha --check-leaks --recursive --globals _scratch --opts ./test/.mocharc",nyc_mocha:"nyc npm run _mocha",_lint:"eslint --ignore-path .gitignore .",build:"webpack-cli --config ./webpack/node/core.webpack.config.js","build-web":"webpack-cli --config ./webpack/web-experimental/core.webpack.config.js",format:'prettier --write "{lib,perf,test}/**/*.js" && eslint --fix --ignore-path .gitignore .',prepublishOnly:"npm run test && npm run build && npm run test-build && cp npm-shrinkwrap.json npm-shrinkwrap.json.bak && rm -rf node_modules/web3-providers-ws/node_modules/websocket/.git && npm prune --only=prod",postpublish:"rm npm-shrinkwrap.json && mv npm-shrinkwrap.json.bak npm-shrinkwrap.json && npm ci",test:"npm run _lint && npm run nyc_mocha","test-build":"cross-env TEST_BUILD=node npm run _mocha","test-web-experimental":"cross-env TEST_BUILD=web-experimental npm run _mocha",coverage:"nyc report --reporter=text-lcov | coveralls"},dependencies:{"abstract-leveldown":"3.0.0",async:"2.6.2",bip39:"2.5.0",cachedown:"1.0.0",clone:"2.1.2",debug:"3.2.6","encoding-down":"5.0.4","eth-sig-util":"2.3.0","ethereumjs-abi":"0.6.7","ethereumjs-account":"3.0.0","ethereumjs-block":"2.2.0","ethereumjs-tx":"1.3.7","ethereumjs-util":"6.1.0","ethereumjs-vm":"3.0.0",heap:"0.2.6","level-sublevel":"6.6.4",levelup:"3.1.1",lodash:"4.17.14","merkle-patricia-tree":"2.3.2",seedrandom:"3.0.1","source-map-support":"0.5.12",tmp:"0.1.0","web3-provider-engine":"14.2.1",websocket:"1.0.29"},devDependencies:{"@types/web3":"^1.0.19","assert-match":"^1.1.1",browserfs:"1.4.3",coveralls:"^3.0.4","cross-env":"5.2.0",eslint:"5.7.0","eslint-config-standard":"12.0.0","eslint-plugin-import":"2.14.0","eslint-plugin-node":"7.0.1","eslint-plugin-promise":"4.2.1","eslint-plugin-standard":"4.0.0","ethereumjs-wallet":"0.6.3",ethers:"4.0.26",husky:"^1.1.3","js-scrypt":"0.2.0","lint-staged":"^8.0.4",memdown:"^1.3.1",mocha:"5.2.0","mocha-lcov-reporter":"^1.3.0","number-to-bn":"1.7.0",nyc:"^14.1.1",pify:"4.0.0",portfinder:"^1.0.18",prettier:"^1.18.2",request:"^2.88.0",semver:"5.6.0",solc:"0.5.10",temp:"0.8.3","terser-webpack-plugin":"1.3.0",web3:"1.2.1",webpack:"4.17.1","webpack-bundle-size-analyzer":"2.7.0","webpack-cli":"3.1.0"},optionalDependencies:{"ethereumjs-wallet":"0.6.3",web3:"1.2.1"},repository:{type:"git",url:"https://github.com/trufflesuite/ganache-core"},license:"MIT",husky:{hooks:{"pre-commit":"lint-staged"}},"lint-staged":{"*.js":["prettier --write","eslint --fix --ignore-path .gitignore","git add"]},eslintConfig:{root:!0,env:{node:!0,es6:!0},parserOptions:{ecmaVersion:8,sourceType:"module",ecmaFeatures:{impliedStrict:!0}},extends:"standard",rules:{"brace-style":["error","1tbs",{allowSingleLine:!1}],curly:["error","all"],"max-len":["error",120,{ignoreRegExpLiterals:!0}],quotes:["error","double"],semi:["error","always"],"space-before-function-paren":["error","never"],"wrap-iife":["error","outside"]}},prettier:{printWidth:120,arrowParens:"always"}}},function(e,t,n){const r=n(15);var o=n(32);function GanacheBlockTracker(e){if(e=e||{},r.apply(this),!e.blockchain)throw new Error("RpcBlockTracker - no blockchain specified.");if(!e.blockchain.on)throw new Error("RpcBlockTracker - blockchain is not an EventEmitter.");this._blockchain=e.blockchain,this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.getTrackingBlock=this.getTrackingBlock.bind(this),this.awaitCurrentBlock=this.awaitCurrentBlock.bind(this),this._setCurrentBlock=this._setCurrentBlock.bind(this)}GanacheBlockTracker.prototype=Object.create(r.prototype),GanacheBlockTracker.prototype.constructor=GanacheBlockTracker,GanacheBlockTracker.prototype.getTrackingBlock=function(){return this._currentBlock},GanacheBlockTracker.prototype.getCurrentBlock=function(){return this._currentBlock},GanacheBlockTracker.prototype.awaitCurrentBlock=function(){const e=this;return this._currentBlock?this._currentBlock:new Promise(e=>this.once("block",e)).then(()=>e._currentBlock)},GanacheBlockTracker.prototype.start=function(e={}){return this._blockchain.on("block",this._setCurrentBlock),Promise.resolve()},GanacheBlockTracker.prototype.stop=function(){this._isRunning=!1,this._blockchain.removeListener("block",this._setCurrentBlock)},GanacheBlockTracker.prototype._setCurrentBlock=function(e){let t=o.toJSON(e,!0);if(this._currentBlock&&this._currentBlock.hash===t.hash)return;const n=this._currentBlock;this._currentBlock=t,this.emit("latest",t),this.emit("sync",{block:t,oldBlock:n}),this.emit("block",t)},e.exports=GanacheBlockTracker},function(e,t,n){n(6);var r=n(20),o=n(103),i=n(105),a=n(5);e.exports={create:function(e){var t=(e=c(e||{})).logger,n=new r(e),a=i(n,t);a.keepAliveTimeout=e.keepAliveTimeout;let s=0;const u={};a.on("connection",e=>{let t=s++;u[t]=e,e.on("close",()=>delete u[t])});var l=a.listen;a.listen=function(){var e=Array.prototype.slice.call(arguments),t=function(){};if(e.length>0){var n=e[e.length-1];"function"==typeof n&&(t=e.pop())}var r=function(e){if(e)return t(e);a.provider.manager.waitForInitialization(t)};e.push(r),l.apply(a,e)},a.provider=n,e.ws&&o(a,n,t);var h=a.close;return a.close=function(e){var t=Array.prototype.slice.call(arguments);h.apply(a,t),a.provider.close(function(t){if(t)return e(t);Object.keys(u).forEach(e=>{try{u[e].destroy()}catch(e){}})})},a}};const s={logger:{log:function(){}},ws:!0,keepAliveTimeout:5e3};var c=function(e){return a.merge({},s,e)}},function(e,t,n){var r=n(104),o=r.server;function ConnectionManager(e,t){const n=this;n.provider=e,n.logger=t,n.connectionsBySubscriptionId={},n.connections={},n.connectionCounter=0,n._updateSubscriptions=n._updateSubscriptions.bind(n),n.manageConnection=n.manageConnection.bind(n),n._logPayload=n._logPayload.bind(n),n._handleRequest=n._handleRequest.bind(n),e.on("data",function(e,t){e||n._updateSubscriptions(t)})}e.exports=function(e,t,n){var r=new ConnectionManager(t,n),i=new o({httpServer:e,autoAcceptConnections:!0});return i.on("connect",r.manageConnection),i},ConnectionManager.prototype.manageConnection=function(e){const t=this;e.id=++t.connectionCounter,t.connections[e.id]={connection:e,subscriptions:{}},e.on("message",function(n){let o;try{if("utf8"===n.type)o=JSON.parse(n.utf8Data);else{if("binary"!==n.type)throw new Error("Invalid message type");o=JSON.parse(n.binaryData.toString("utf8").trim())}}catch(t){return void e.close(r.connection.CLOSE_REASON_UNPROCESSABLE_INPUT,t.message)}t._logPayload(o),t._handleRequest(e,o)}),e.on("close",function(){Object.keys(t.connections[e.id].subscriptions).forEach(e=>{t.provider.send({jsonrpc:"2.0",method:"eth_unsubscribe",params:[e],id:(new Date).getTime()},function(n,r){n||delete t.connectionsBySubscriptionId[e]})}),delete t.connections[e.id]})},ConnectionManager.prototype._handleRequest=function(e,t){const n=this;switch(t.method){case"eth_subscribe":n.provider.send(t,function(t,r){!t&&r.result&&n.connections[e.id]&&(n.connections[e.id].subscriptions[r.result]=!0,n.connectionsBySubscriptionId[r.result]=n.connections[e.id]),e.send(JSON.stringify(r))});break;case"eth_unsubscribe":n.provider.send(t,function(r,o){r||o.error?e&&e.send&&e.send(JSON.stringify(o)):(n.connections[e.id]&&delete n.connections[e.id].subscriptions[t.params[0]],delete n.connectionsBySubscriptionId[t.params[0]],e.send(JSON.stringify(o)))});break;default:n.provider.send(t,function(t,n){e.send(JSON.stringify(n))})}},ConnectionManager.prototype._logPayload=function(e){const t=this;if(e instanceof Array)for(var n=0;n<e.length;n++){var r=e[n];t.logger.log(r.method)}else t.logger.log(e.method)},ConnectionManager.prototype._updateSubscriptions=function(e){const t=this.connectionsBySubscriptionId[e.params.subscription];t&&t.connection.send(JSON.stringify(e))}},function(e,t){e.exports=require("websocket")},function(e,t,n){const r=n(106),{rpcError:o}=n(0);function sendResponse(e,t,n,r){e.writeHead(t,n),e.end(r)}e.exports=function(e,t){var n=r.createServer(function(n,r){var i=n.method,a=[];n.on("data",function(e){a.push(e)}).on("end",function(){a=Buffer.concat(a).toString();const s=function(e,t){const n={};return t.hasOwnProperty("origin")&&("OPTIONS"===e&&(n["Access-Control-Allow-Methods"]="POST",t.hasOwnProperty("access-control-request-headers")&&(n["Access-Control-Allow-Headers"]=t["access-control-request-headers"]),n["Content-Length"]=0,n["Access-Control-Max-Age"]=600),n["Access-Control-Allow-Credentials"]=!0,n["Access-Control-Allow-Origin"]=t.origin),n}(i,n.headers);switch(i){case"POST":var c;try{c=JSON.parse(a)}catch(e){return s["Content-Type"]="text/plain",void sendResponse(r,400,s,"400 Bad Request")}if(c instanceof Array)for(var u=0;u<c.length;u++){var l=c[u];t.log(l.method)}else t.log(c.method);if("eth_subscribe"===c.method||"eth_unsubscribe"===c.method){s["Content-Type"]="application/json",sendResponse(r,400,s,o(c.id,-32e3,"notifications not supported"));break}e.send(c,function(e,t){s["Content-Type"]="application/json",sendResponse(r,200,s,JSON.stringify(t))});break;case"OPTIONS":sendResponse(r,204,s);break;default:s["Content-Type"]="text/plain",sendResponse(r,400,s,"400 Bad Request")}})});return n.ganacheProvider=e,n}},function(e,t){e.exports=require("http")}])});
//# sourceMappingURL=ganache.core.node.js.map